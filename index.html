<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ù–∞–π–¥–∏ —Å–≤–æ—é –¥–∏–∑–∞–π–Ω-–ø—Ä–æ—Ñ–µ—Å—Å–∏—é</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
@font-face { font-family:'PPNeueMachina'; src:url('https://design.synergy.ru/fonts/PPNeueMachina-Ultrabold.woff2') format('woff2'); font-weight:800; }
@font-face { font-family:'Gilroy'; src:url('https://design.synergy.ru/fonts/Gilroy-Semibold.woff2') format('woff2'); font-weight:600; }
@font-face { font-family:'Gilroy'; src:url('https://design.synergy.ru/fonts/Gilroy-Bold.woff2') format('woff2'); font-weight:700; }

*{margin:0;padding:0;box-sizing:border-box}
:root{
  --dark:#222222; --surface:#2a2a2a; --surface2:#333; --border:rgba(255,255,255,0.12);
  --white:#fff; --muted:#868686; --cyan:#00e5ff; --purple:#b388ff;
  --green:#4ade80; --amber:#fbbf24; --pink:#ff6b9d; --red:#c8102e;
  --line:rgba(255,255,255,0.15); --muted2:#868686;
}
body{font-family:'Gilroy','Helvetica Neue',sans-serif;background:var(--dark);color:var(--white);min-height:100vh;overflow-x:hidden;font-weight:600}

.screen{display:none;padding:28px 20px 20px;max-width:860px;margin:0 auto;animation:fadeIn .5s ease;box-sizing:border-box}
.screen.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

.progress-bar{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--cyan),var(--purple));transition:width .5s;z-index:100}

/* XP HUD */
.xp-hud{position:fixed;top:12px;right:16px;z-index:101;display:flex;align-items:center;gap:12px;background:rgba(34,34,34,0.92);backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:77px;padding:6px 16px 6px 10px;opacity:0;transform:translateY(-20px);transition:all .5s ease;pointer-events:none}
.xp-hud.visible{opacity:1;transform:translateY(0);pointer-events:auto}
.xp-hud-lvl{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:14px;background:linear-gradient(135deg,var(--cyan),var(--purple));color:var(--dark);flex-shrink:0}
.xp-hud-info{display:flex;flex-direction:column;gap:2px}
.xp-hud-name{font-size:12px;font-weight:700;color:var(--white);line-height:1}
.xp-hud-bar{width:100px;height:4px;background:rgba(255,255,255,0.1);border-radius:2px;overflow:hidden}
.xp-hud-fill{height:100%;background:linear-gradient(90deg,var(--cyan),var(--purple));border-radius:2px;transition:width .8s cubic-bezier(.4,0,.2,1);width:0}
.xp-hud-xp{font-size:12px;font-family:'PPNeueMachina',sans-serif;font-weight:800;color:var(--cyan);line-height:1}

/* XP popup */
.xp-popup{position:fixed;top:50%;left:50%;z-index:102;background:rgba(34,34,34,0.97);backdrop-filter:blur(16px);border:1px solid var(--cyan);border-radius:20px;padding:28px 36px;opacity:0;transform:translate(-50%,-50%) scale(0.9);transition:all .4s cubic-bezier(.4,0,.2,1);pointer-events:none;min-width:280px;text-align:center;box-shadow:0 0 60px rgba(0,229,255,0.12)}
.xp-popup.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
.xp-popup-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);margin-bottom:8px}
.xp-popup-xp{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:22px;color:var(--white);margin-bottom:4px}
.xp-popup-ach{font-size:13px;color:var(--amber);margin-top:6px}
.xp-popup-acc{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:15px;color:var(--white);margin-bottom:6px}
.xp-popup-acc-bar{width:100%;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;margin-bottom:10px}
.xp-popup-acc-fill{height:100%;border-radius:3px;transition:width 1s cubic-bezier(.4,0,.2,1);width:0}
.xp-popup-lvlup{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:14px;color:var(--green);margin-top:6px;animation:lvlPulse 1s ease infinite alternate}
@keyframes lvlPulse{from{opacity:.7}to{opacity:1}}

.module-tag{display:inline-block;font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);background:rgba(0,229,255,0.1);padding:5px 14px;border-radius:77px;margin-bottom:10px}
.module-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:clamp(1.3rem,3.5vw,2rem);text-transform:uppercase;margin-bottom:6px}
.module-desc{color:var(--muted);font-size:.9rem;line-height:1.5;margin-bottom:16px}

.btn{display:inline-flex;align-items:center;gap:8px;padding:14px 32px;border-radius:77px;border:1.5px solid var(--cyan);background:transparent;color:var(--white);font-family:'Gilroy',sans-serif;font-size:14px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;cursor:pointer;transition:all .3s}
.btn:hover{background:var(--cyan);color:var(--dark)}
.btn:disabled{opacity:.3;cursor:not-allowed;background:transparent;color:var(--white)}
.btn-row{display:flex;justify-content:flex-end;margin-top:18px}

/* WELCOME */
.welcome-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:clamp(2.2rem,6vw,4rem);text-transform:uppercase;line-height:1;margin-bottom:20px}
.welcome-title .hl{background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.welcome-sub{font-size:1rem;color:var(--muted);line-height:1.6;margin-bottom:24px;max-width:560px}
.welcome-meta{display:flex;gap:20px;margin-bottom:28px;flex-wrap:wrap}
.welcome-meta span{font-size:14px;color:var(--muted);display:flex;align-items:center;gap:6px}

/* CARDS */
.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:12px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:all .3s;position:relative}
.card:hover{border-color:var(--cyan);transform:translateY(-2px)}
.card.selected{border-color:var(--cyan);background:rgba(0,229,255,0.06);box-shadow:0 0 20px rgba(0,229,255,0.08)}
.card .emoji{font-size:1.5rem;margin-bottom:8px}
.card .label{font-weight:700;font-size:.95rem}
.card .hint{font-size:13px;color:var(--muted);margin-top:4px}

/* KERNING */
.kerning-workspace{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:48px 20px;text-align:center;margin-top:20px;touch-action:none}
.kerning-word{display:inline-flex;align-items:baseline;font-family:'PPNeueMachina',sans-serif;font-size:clamp(3rem,9vw,5.5rem);font-weight:800;user-select:none}
.kerning-letter{position:relative;cursor:grab;transition:color .2s;padding:0 2px}
.kerning-letter.dragging{color:var(--cyan);cursor:grabbing}
.kerning-letter.fixed{cursor:default;color:var(--muted)}
.kerning-hint{margin-top:20px;font-size:14px;color:var(--muted)}

/* CHOICE */
.choice-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;margin-top:12px}
.choice-card{background:var(--surface);border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .3s}
.choice-card:hover{border-color:var(--cyan);transform:translateY(-2px)}
.choice-card.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.choice-img{width:100%;aspect-ratio:4/3;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:3rem;overflow:hidden;position:relative}
.choice-img img{width:100%;height:100%;object-fit:cover;display:block}
.choice-label{padding:14px;font-weight:600;font-size:14px;text-align:center}

/* ARGUMENT */
.arg-grid{display:grid;gap:10px;margin-top:16px}
.arg-chip{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 18px;cursor:pointer;font-size:14px;transition:all .3s}
.arg-chip:hover{border-color:var(--cyan)}
.arg-chip.selected{border-color:var(--amber);background:rgba(251,191,36,0.08)}

/* CASE */
.case-brief{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin:20px 0}
.brief-label{font-family:'PPNeueMachina',sans-serif;font-size:12px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--amber);margin-bottom:8px}
.case-options{display:flex;flex-direction:column;gap:10px;margin-top:16px}
.case-opt{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 20px;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:14px}
.case-opt:hover{border-color:var(--cyan)}
.case-opt.selected{border-color:var(--green);background:rgba(74,222,128,0.06)}
.case-opt .opt-icon{font-size:1.4rem}
.case-opt .opt-text{font-size:14px}

/* DRAWING */
.draw-workspace{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:14px;margin-top:12px;text-align:center}
.draw-toolbar{display:flex;gap:8px;justify-content:center;margin-bottom:16px;flex-wrap:wrap}
.draw-toolbar button{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 14px;color:var(--white);font-family:'Gilroy',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .3s}
.draw-toolbar button:hover,.draw-toolbar button.active{border-color:var(--cyan);color:var(--cyan)}
.draw-canvas{border:1px solid var(--border);border-radius:8px;cursor:crosshair;background:#1a1a1a;display:block;margin:0 auto;width:100%;max-width:600px;touch-action:none;-webkit-user-select:none;user-select:none}
.draw-workspace{touch-action:none}
body.no-scroll{overflow:hidden!important;position:fixed;width:100%;top:0;left:0}

/* ASSEMBLY (pointer-based for mobile) */
.assembly-area{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:12px}
.assembly-palette{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px}
.assembly-palette-title{font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:12px}
.assembly-blocks{display:flex;flex-direction:column;gap:8px}
.assembly-block{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px;cursor:pointer;transition:all .2s;font-size:14px;user-select:none;overflow:hidden}
.assembly-block:hover{border-color:var(--cyan)}
.assembly-canvas{background:var(--surface);border:2px dashed var(--border);border-radius:14px;padding:12px;min-height:220px;display:flex;flex-direction:column;gap:6px;transition:border-color .3s}
.assembly-canvas.over{border-color:var(--cyan)}
.assembly-canvas-title{font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.assembly-slot{background:rgba(0,229,255,0.04);border:1px solid var(--border);border-radius:8px;padding:8px;font-size:14px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s;overflow:hidden}
.assembly-slot:hover{border-color:var(--pink)}
.assembly-slot .remove{margin-left:auto;color:var(--muted);cursor:pointer;font-size:16px}

/* COLOR */
.color-options{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
.color-opt{border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .3s}
.color-opt:hover{border-color:var(--cyan);transform:translateY(-2px)}
.color-opt.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.color-swatches{display:flex;height:80px}
.color-swatches div{flex:1}
.color-opt-label{padding:12px;font-size:13px;text-align:center;font-weight:600}

/* FONT */
.font-pairs{display:flex;flex-direction:column;gap:14px;margin-top:20px}
.font-pair{display:grid;grid-template-columns:1fr 1fr;gap:2px;border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .3s}
.font-pair:hover{border-color:var(--cyan)}
.font-pair.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.font-left{background:var(--surface);padding:20px;display:flex;align-items:center;justify-content:center}
.font-right{background:var(--surface2);padding:20px;display:flex;flex-direction:column;justify-content:center;gap:4px}
.font-sample{line-height:1.3}
.font-name{font-size:12px;color:var(--muted);margin-top:4px}

/* SPOT ERROR */
.spot-workspace{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:12px}
.spot-item{background:var(--surface);border:2px solid var(--border);border-radius:12px;overflow:hidden;cursor:pointer;transition:all .3s}
.spot-item:hover{border-color:var(--cyan);transform:translateY(-2px)}
.spot-item.selected{border-color:var(--pink);box-shadow:0 0 16px rgba(255,107,157,0.15)}
.spot-preview{padding:20px 16px;min-height:120px;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:8px}
.spot-label{padding:10px 14px;font-size:12px;font-weight:700;color:var(--muted);text-align:center;border-top:1px solid var(--border)}

/* PROPORTION */
.proportion-workspace{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px 20px;margin-top:20px;text-align:center}
.proportion-canvas{display:block;margin:0 auto;border:1px solid var(--border);border-radius:8px;cursor:ew-resize;touch-action:none;width:100%;max-width:560px}
.proportion-hint{font-size:14px;color:var(--muted);margin-top:16px}
.proportion-value{font-family:'PPNeueMachina',sans-serif;font-size:20px;margin-top:8px;color:var(--cyan)}

/* SELF-ASSESSMENT */
.sa-pair{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px}
.sa-counter{font-family:'PPNeueMachina',sans-serif;font-size:12px;font-weight:800;letter-spacing:2px;color:var(--muted);margin-bottom:16px}
.sa-options{display:flex;flex-direction:column;gap:10px}
.sa-opt{background:var(--surface2);border:2px solid var(--border);border-radius:12px;padding:12px 16px;cursor:pointer;transition:all .3s;font-size:14px;line-height:1.4}
.sa-opt:hover{border-color:var(--cyan)}
.sa-opt.selected{border-color:var(--green);background:rgba(74,222,128,0.06)}

/* MOODBOARD */
.mood-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-top:10px}
.mood-item{background:var(--surface);border:2px solid var(--border);border-radius:12px;overflow:hidden;cursor:pointer;transition:all .3s}
.mood-item:hover{border-color:var(--cyan);transform:translateY(-2px)}
.mood-item.selected{border-color:var(--green);background:rgba(74,222,128,0.06);box-shadow:0 0 16px rgba(74,222,128,0.1)}
.mood-img{width:100%;aspect-ratio:1;object-fit:cover;display:block;background:var(--surface2)}
.mood-emoji{font-size:2.5rem;display:flex;align-items:center;justify-content:center;width:100%;aspect-ratio:1;background:var(--surface2)}
.mood-label{font-size:11px;font-weight:700;line-height:1.3;color:var(--muted);padding:10px 8px;text-align:center}
.mood-counter{text-align:center;margin-top:16px;font-size:14px;color:var(--muted)}
.mood-counter .hl{color:var(--cyan);font-weight:700}

/* ROLE */
.role-scenario{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px}
.role-scenario-label{font-family:'PPNeueMachina',sans-serif;font-size:12px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--purple);margin-bottom:8px}
.role-scenario-text{font-size:15px;color:var(--muted);line-height:1.5;margin-bottom:16px}
.role-options{display:flex;flex-direction:column;gap:10px}
.role-opt{background:var(--surface2);border:2px solid var(--border);border-radius:12px;padding:12px 14px;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:10px;font-size:13px}
.role-opt:hover{border-color:var(--purple)}
.role-opt.selected{border-color:var(--green);background:rgba(74,222,128,0.06)}
.role-opt .opt-icon{font-size:1.4rem;flex-shrink:0}

/* MATERIALS */
.mat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
.mat-card{background:var(--surface);border:2px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:all .3s;text-align:center}
.mat-card:hover{border-color:var(--cyan);transform:translateY(-2px)}
.mat-card.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.mat-swatch{height:100px;overflow:hidden;border-radius:12px 12px 0 0}
.mat-label{padding:10px;font-size:13px;font-weight:600}
.mat-hint{font-size:11px;color:var(--muted);padding:0 10px 10px}

/* EMPATHY */
.empathy-mockups{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.empathy-opt{background:var(--surface);border:2px solid var(--border);border-radius:14px;padding:14px;cursor:pointer;transition:all .3s}
.empathy-opt:hover{border-color:var(--cyan)}
.empathy-opt.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.empathy-mockup{min-height:100px;margin-bottom:8px}
.empathy-label{font-size:13px;font-weight:600;text-align:center}

/* COLOR MEMORY */
.cm-palette{display:flex;gap:6px;justify-content:center;margin:20px 0;padding:16px;background:var(--surface);border-radius:14px}
.cm-swatch{width:48px;height:48px;border-radius:10px}
.cm-options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px}
.cm-opt{background:var(--surface);border:2px solid var(--border);border-radius:14px;padding:12px;cursor:pointer;transition:all .3s;display:flex;gap:4px;justify-content:center}
.cm-opt:hover{border-color:var(--cyan)}
.cm-opt.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.cm-opt .cm-swatch{width:36px;height:36px;border-radius:8px}

/* SPATIAL */
.spatial-unfold{display:flex;justify-content:center;margin:16px 0;padding:20px;background:var(--surface);border-radius:14px}
.spatial-options{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
.spatial-opt{background:var(--surface);border:2px solid var(--border);border-radius:14px;padding:16px;cursor:pointer;transition:all .3s;text-align:center}
.spatial-opt:hover{border-color:var(--cyan);transform:translateY(-2px)}
.spatial-opt.selected{border-color:var(--green);box-shadow:0 0 16px rgba(74,222,128,0.15)}
.spatial-opt svg{max-width:100%;height:auto}
.spatial-opt-label{margin-top:8px;font-size:13px;font-weight:600}

/* STYLE VS FUNCTION */
.sf-pair{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0}
.sf-chair{background:var(--surface);border-radius:14px;padding:16px;text-align:center}
.sf-chair svg{max-width:100%;height:auto}
.sf-chair-label{margin-top:8px;font-size:13px;font-weight:600}
.sf-chair-desc{font-size:12px;color:var(--muted);margin-top:4px}
.sf-contexts{display:flex;flex-direction:column;gap:10px}
.sf-context{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px}
.sf-context-label{font-family:'PPNeueMachina',sans-serif;font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--amber);margin-bottom:8px}
.sf-context-q{font-size:14px;color:var(--muted);margin-bottom:12px}
.sf-btns{display:flex;gap:8px}
.sf-btn{flex:1;background:var(--surface2);border:2px solid var(--border);border-radius:10px;padding:10px;cursor:pointer;transition:all .3s;font-size:13px;font-weight:600;color:var(--white);text-align:center;font-family:'Gilroy',sans-serif}
.sf-btn:hover{border-color:var(--cyan)}
.sf-btn.selected{border-color:var(--green);background:rgba(74,222,128,0.06)}

/* ===== RESULTS PAGE STYLES ===== */
.results-container{max-width:1280px;margin:0 auto;padding:0 20px}
.hero{background:var(--dark);color:var(--white);padding:60px 0 40px;position:relative;overflow:hidden}
.hero-inner{display:flex;align-items:flex-start;justify-content:space-between;gap:40px;position:relative;z-index:1}
.hero-left{flex:1}
.hero-class{font-family:'PPNeueMachina','Arial Black',sans-serif;font-weight:800;font-size:clamp(2rem,6vw,4rem);text-transform:uppercase;line-height:1.0;letter-spacing:-0.02em;margin-bottom:28px}
.hero-class .highlight{background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-desc{font-size:1rem;line-height:1.7;color:var(--muted2);max-width:520px;font-weight:600}
.hero-right{display:flex;flex-direction:column;align-items:flex-end;gap:16px;flex-shrink:0}
.hero-icon{width:100px;height:100px;display:flex;align-items:center;justify-content:center;font-size:2.5rem;background:linear-gradient(135deg,rgba(0,229,255,0.1),rgba(179,136,255,0.1));border:2px solid rgba(0,229,255,0.3);border-radius:50%;animation:iconPulse 3s ease-in-out infinite}
.tg-avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:2px solid rgba(0,229,255,0.4);box-shadow:0 0 20px rgba(0,229,255,0.15)}
.hero-avatar-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
.hero-avatar-name{font-size:13px;color:var(--muted);font-weight:700;text-align:center}
@keyframes iconPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.04);opacity:.8}}

.divider{border:none;border-top:1px solid var(--line);margin:0}
.level-section{padding:40px 0}
.level-grid{display:flex;align-items:center;gap:24px;flex-wrap:wrap}
.lvl-badge{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:3.5rem;line-height:1;background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.lvl-badge span{display:block;font-size:12px;letter-spacing:3px;opacity:.5;margin-top:4px;-webkit-text-fill-color:var(--muted2)}
.lvl-info{flex:1;min-width:140px}
.lvl-name{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:1.1rem;text-transform:uppercase;margin-bottom:6px}
.lvl-sub{font-size:.9rem;color:rgba(255,255,255,0.3)}
.xp-area{min-width:200px;flex:1}
.xp-meta{font-size:12px;color:var(--muted2);margin-bottom:8px;display:flex;justify-content:space-between;text-transform:uppercase;letter-spacing:1px}
.xp-bar{height:6px;background:rgba(255,255,255,0.08);border-radius:3px;overflow:hidden}
.xp-fill{height:100%;border-radius:3px;width:0;background:linear-gradient(90deg,var(--cyan),var(--purple));transition:width 1.5s cubic-bezier(.22,1,.36,1)}
.lvl-scale{width:100%;margin-top:20px}
.lvl-pips{display:flex;gap:4px}
.lvl-pip{height:5px;flex:1;border-radius:3px;background:rgba(255,255,255,0.08)}
.lvl-pip.filled{background:linear-gradient(90deg,var(--cyan),var(--purple))}
.lvl-pip.current{background:var(--pink);box-shadow:0 0 8px rgba(255,107,157,0.4)}
.lvl-labels{display:flex;justify-content:space-between;margin-top:8px}
.lvl-labels span{font-size:12px;color:var(--muted2);text-transform:uppercase;letter-spacing:1px}

.section{padding:40px 0}
.section-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:clamp(1.4rem,4vw,2.2rem);text-transform:uppercase;margin-bottom:32px;letter-spacing:-0.01em}
.section-label{font-size:12px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--cyan);margin-bottom:14px}

.radar-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
.radar-card{text-align:center;position:relative}
.radar-card h3{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);margin-bottom:16px}
.radar-card canvas{max-width:100%;height:auto}

.flow-card{overflow-x:auto;-webkit-overflow-scrolling:touch}
.flow-canvas-wrap{position:relative;min-width:1200px}
#flowCanvas{display:block;width:100%}

.demand-grid{display:grid;grid-template-columns:1fr 1fr;gap:32px}
.demand-col-label{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:12px;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);margin-bottom:24px;padding-bottom:14px;border-bottom:1px solid var(--line)}
.d-card{border:1px solid var(--line);border-radius:0;padding:24px;margin-bottom:16px;transition:all .3s;position:relative;overflow:hidden}
.d-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--cyan),var(--purple),transparent);opacity:0;transition:opacity .3s}
.d-card:hover{border-color:rgba(0,229,255,0.3)}
.d-card:hover::before{opacity:1}
.d-head{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.d-icon{font-size:1.4rem}
.d-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:.9rem;text-transform:uppercase}
.d-metrics{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:16px}
.d-m{text-align:center;padding:12px 4px;border:1px solid var(--line)}
.d-m-val{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:1rem}
.d-m-val.hot{color:var(--green)}
.d-m-val.warm{color:var(--amber)}
.d-m-label{font-size:12px;color:var(--muted2);margin-top:4px;text-transform:uppercase;letter-spacing:.5px}
.d-chart{height:150px;position:relative;border:1px solid var(--line);padding:24px 16px;margin-bottom:16px}
.d-chart canvas{width:100%!important;height:100%!important}
.d-chips{display:flex;flex-wrap:wrap;gap:6px}
.d-chip{font-size:12px;padding:6px 14px;border-radius:77px;border:1px solid var(--line);color:var(--muted2);text-transform:uppercase;letter-spacing:.5px}
.d-trend{display:inline-flex;align-items:center;gap:4px;font-size:12px;padding:5px 14px;border-radius:77px;margin-top:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;border:1px solid}
.d-trend.up{border-color:var(--green);color:var(--green)}

.ach-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}
.ach-item{display:flex;align-items:center;gap:8px;background:rgba(0,229,255,0.06);border:1px solid rgba(0,229,255,0.2);border-radius:77px;padding:8px 18px;font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px}

.share-section{text-align:center;padding:48px 0}
.share-title{font-family:'PPNeueMachina',sans-serif;font-weight:800;font-size:clamp(1.2rem,3vw,1.8rem);text-transform:uppercase;margin-bottom:24px}
.btn-pill{display:inline-flex;align-items:center;gap:8px;padding:14px 32px;border-radius:77px;border:1.5px solid var(--cyan);background:transparent;color:var(--white);font-family:'Gilroy',sans-serif;font-size:14px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;cursor:pointer;transition:all .3s;text-decoration:none}
.btn-pill:hover{background:var(--cyan);color:var(--dark)}

.reveal{opacity:0;transform:translateY(24px);transition:opacity .6s cubic-bezier(.22,1,.36,1),transform .6s cubic-bezier(.22,1,.36,1)}
.reveal.visible{opacity:1;transform:translateY(0)}

/* RESPONSIVE */
@media(max-width:600px){
  .screen{padding:18px 14px 14px}
  .card-grid{grid-template-columns:1fr 1fr}
  .assembly-area{grid-template-columns:1fr}
  .radar-grid{grid-template-columns:1fr}
  .demand-grid{grid-template-columns:1fr}
  .hero-inner{flex-direction:column}
  .hero-right{align-items:flex-start}
  .level-grid{gap:16px}
  .color-options{grid-template-columns:1fr 1fr}
  .empathy-mockups{grid-template-columns:1fr}
  .sf-pair{grid-template-columns:1fr}
  .spatial-options{grid-template-columns:1fr 1fr}
  .mat-grid{grid-template-columns:1fr 1fr}
  .cm-options{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="progress-bar" id="progressBar"></div>

<div class="xp-hud" id="xpHud">
  <div class="xp-hud-lvl" id="hudLvl">1</div>
  <div class="xp-hud-info">
    <div class="xp-hud-name" id="hudName">–ù–æ–≤–∏—á–æ–∫</div>
    <div class="xp-hud-bar"><div class="xp-hud-fill" id="hudFill"></div></div>
  </div>
  <div class="xp-hud-xp" id="hudXp">0 XP</div>
</div>

<div class="xp-popup" id="xpPopup">
  <div class="xp-popup-title">–ú–æ–¥—É–ª—å –ø—Ä–æ–π–¥–µ–Ω!</div>
  <div class="xp-popup-acc" id="popupAcc"></div>
  <div class="xp-popup-acc-bar" id="popupAccBar" style="display:none"><div class="xp-popup-acc-fill" id="popupAccFill"></div></div>
  <div class="xp-popup-xp" id="popupXp">+0 XP</div>
  <div class="xp-popup-ach" id="popupAch"></div>
  <div class="xp-popup-lvlup" id="popupLvl" style="display:none">‚¨Ü –£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù!</div>
</div>

<!-- SCREEN: WELCOME -->
<div class="screen active" id="screen-welcome">
  <div style="padding-top:24px">
    <div class="welcome-title"><span class="hl">–ù–∞–π–¥–∏ —Å–≤–æ—é</span><br>–¥–∏–∑–∞–π–Ω-–ø—Ä–æ—Ñ–µ—Å—Å–∏—é</div>
    <div class="welcome-sub">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç –∏–∑ 19 —à–∞–≥–æ–≤: —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞, –º—É–¥–±–æ—Ä–¥, –∫–µ—Ä–Ω–∏–Ω–≥, –∫–µ–π—Å—ã, —Ä–∏—Å–æ–≤–∞–Ω–∏–µ, —Ü–≤–µ—Ç, —ç–º–ø–∞—Ç–∏—è, –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ ‚Äî —É–∑–Ω–∞–π, –∫–∞–∫–∞—è –¥–∏–∑–∞–π–Ω-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.</div>
    <div class="welcome-meta">
      <span>‚è± ~20 –º–∏–Ω—É—Ç</span><span>üéÆ 19 —à–∞–≥–æ–≤</span><span>üìä –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</span>
    </div>
    <button class="btn" onclick="go('screen-edu')">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç ‚Üí</button>
  </div>
</div>

<!-- SCREEN: EDUCATION -->
<div class="screen" id="screen-edu">
  <div class="module-tag">–®–∞–≥ 1</div>
  <div class="module-title">–¢–≤–æ—ë –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
  <div class="module-desc">–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</div>
  <div class="card-grid" id="eduGrid">
    <div class="card" data-v="9class" onclick="selectCard(this,'edu')"><div class="emoji">üìö</div><div class="label">9 –∫–ª–∞—Å—Å–æ–≤</div><div class="hint">–£—á—É—Å—å –∏–ª–∏ –æ–∫–æ–Ω—á–∏–ª(–∞)</div></div>
    <div class="card" data-v="11class" onclick="selectCard(this,'edu')"><div class="emoji">üéì</div><div class="label">11 –∫–ª–∞—Å—Å–æ–≤</div><div class="hint">–£—á—É—Å—å –∏–ª–∏ –æ–∫–æ–Ω—á–∏–ª(–∞)</div></div>
    <div class="card" data-v="spo" onclick="selectCard(this,'edu')"><div class="emoji">üõ†</div><div class="label">–ö–æ–ª–ª–µ–¥–∂ / –°–ü–û</div><div class="hint">–°—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ</div></div>
    <div class="card" data-v="bachelor" onclick="selectCard(this,'edu')"><div class="emoji">üèõ</div><div class="label">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</div><div class="hint">–û–∫–æ–Ω—á–∏–ª(–∞) –∏–ª–∏ —É—á—É—Å—å</div></div>
    <div class="card" data-v="master" onclick="selectCard(this,'edu')"><div class="emoji">üî¨</div><div class="label">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</div><div class="hint">–û–∫–æ–Ω—á–∏–ª(–∞) –∏–ª–∏ —É—á—É—Å—å</div></div>
  </div>
  <div class="btn-row"><button class="btn" id="eduNext" disabled onclick="go('screen-selfassess')">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: SELF-ASSESSMENT -->
<div class="screen" id="screen-selfassess">
  <div class="module-tag">–ú–æ–¥—É–ª—å 2 ¬∑ –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞</div>
  <div class="module-title">–ß—Ç–æ —Ç–µ–±–µ –±–ª–∏–∂–µ?</div>
  <div class="module-desc">–í –∫–∞–∂–¥–æ–π –ø–∞—Ä–µ –≤—ã–±–µ—Ä–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±–æ–ª—å—à–µ –æ—Ç–∫–ª–∏–∫–∞–µ—Ç—Å—è</div>
  <div id="saContainer"></div>
  <div class="btn-row"><button class="btn" id="saNext" disabled onclick="finishSelfAssess()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-kerning">
  <div class="module-tag">–ú–æ–¥—É–ª—å 3 ¬∑ –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞</div>
  <div class="module-title">–ù–∞—Å—Ç—Ä–æ–π –∫–µ—Ä–Ω–∏–Ω–≥</div>
  <div class="module-desc">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π –±—É–∫–≤—ã, —á—Ç–æ–±—ã —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –≤—ã–≥–ª—è–¥–µ–ª–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ</div>
  <div class="kerning-workspace"><div class="kerning-word" id="kerningWord"></div><div class="kerning-hint">‚Üê —Ç—è–Ω–∏ –±—É–∫–≤—ã –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ ‚Üí</div></div>
  <div class="btn-row"><button class="btn" onclick="finishKerning()">–ì–æ—Ç–æ–≤–æ ‚Üí</button></div>
</div>

<div class="screen" id="screen-choice">
  <div class="module-tag">–ú–æ–¥—É–ª—å 4 ¬∑ –ù–∞—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
  <div class="module-title">–ö–∞–∫–æ–π –ª–æ–≥–æ—Ç–∏–ø –ª—É—á—à–µ?</div>
  <div class="module-desc">–ö–æ—Ñ–µ–π–Ω—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ ‚Äî –≤—ã–±–µ—Ä–∏ –Ω–∞–∏–±–æ–ª–µ–µ —É–¥–∞—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç</div>
  <div class="choice-grid" id="choiceGrid"></div>
  <div id="argSection" style="display:none;margin-top:24px">
    <div style="font-weight:700;margin-bottom:10px;font-size:14px;text-transform:uppercase;letter-spacing:1px;color:var(--muted)">–ü–æ—á–µ–º—É —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ª—É—á—à–µ?</div>
    <div class="arg-grid" id="argGrid"></div>
  </div>
  <div class="btn-row"><button class="btn" id="choiceNext" disabled onclick="finishChoice()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: MOODBOARD -->
<div class="screen" id="screen-moodboard">
  <div class="module-tag">–ú–æ–¥—É–ª—å 5 ¬∑ –ú—É–¥–±–æ—Ä–¥</div>
  <div class="module-title">–î–æ—Å–∫–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è</div>
  <div class="module-desc">–í—ã–±–µ—Ä–∏ 5‚Äì7 –∫–∞—Ä—Ç–∏–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–±—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç ‚Äî –Ω–µ –¥—É–º–∞–π –¥–æ–ª–≥–æ, –∏–¥–∏ –∑–∞ –∏–Ω—Ç—É–∏—Ü–∏–µ–π</div>
  <div class="mood-grid" id="moodGrid"></div>
  <div class="mood-counter" id="moodCounter">–í—ã–±—Ä–∞–Ω–æ: <span class="hl">0</span> –∏–∑ 5‚Äì7</div>
  <div class="btn-row"><button class="btn" id="moodNext" disabled onclick="finishMoodboard()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: MATERIALS -->
<div class="screen" id="screen-materials">
  <div class="module-tag">–ú–æ–¥—É–ª—å 6 ¬∑ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
  <div class="module-title">–ò–∑ —á–µ–≥–æ —Å–¥–µ–ª–∞–µ—à—å?</div>
  <div class="module-desc">–¢—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—à—å —Å–≤–µ—Ç–∏–ª—å–Ω–∏–∫. –ö–∞–∫–æ–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤—ã–±–µ—Ä–µ—à—å?</div>
  <div class="mat-grid" id="matGrid"></div>
  <div class="btn-row"><button class="btn" id="matNext" disabled onclick="finishMaterials()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-case">
  <div class="module-tag">–ú–æ–¥—É–ª—å 7 ¬∑ –ö–µ–π—Å</div>
  <div class="module-title">–†–µ—à–∏ –±—Ä–∏—Ñ</div>
  <div class="module-desc">–ü—Ä–æ—á–∏—Ç–∞–π –∑–∞–¥–∞—á—É –∏ –≤—ã–±–µ—Ä–∏, —Å —á–µ–≥–æ –Ω–∞—á–Ω—ë—à—å</div>
  <div class="case-brief"><div class="brief-label">–ë—Ä–∏—Ñ</div><div class="brief-text">–ì–æ—Ä–æ–¥—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ö–æ—á–µ—Ç –ø—Ä–∏–≤–ª–µ—á—å –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤. –°–µ–π—á–∞—Å –æ–Ω–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –µ—ë –∫–∞–∫ —Å–∫—É—á–Ω–æ–µ –º–µ—Å—Ç–æ. –ë—é–¥–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.</div></div>
  <div class="case-options" id="caseOpts"></div>
  <div class="btn-row"><button class="btn" id="caseNext" disabled onclick="finishCase()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: EMPATHY / UX -->
<div class="screen" id="screen-empathy">
  <div class="module-tag">–ú–æ–¥—É–ª—å 8 ¬∑ –≠–º–ø–∞—Ç–∏—è</div>
  <div class="module-title">–ü–æ–º–æ–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</div>
  <div class="module-desc" id="empathyDesc"></div>
  <div class="empathy-mockups" id="empathyOpts"></div>
  <div class="btn-row"><button class="btn" id="empathyNext" disabled onclick="finishEmpathy()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-draw">
  <div class="module-tag">–ú–æ–¥—É–ª—å 9 ¬∑ –†–∏—Å–æ–≤–∞–Ω–∏–µ</div>
  <div class="module-title">–ù–∞—Ä–∏—Å—É–π –ª–æ–≥–æ—Ç–∏–ø</div>
  <div class="module-desc">–ö–æ—Ñ–µ–π–Ω—è ¬´–ó–µ—Ä–Ω–æ¬ª ‚Äî –Ω–∞—Ä–∏—Å—É–π –ø—Ä–æ—Å—Ç–æ–π –∑–Ω–∞–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞—ë—Ç —Å—É—Ç—å –±—Ä–µ–Ω–¥–∞</div>
  <div class="draw-workspace">
    <div class="draw-toolbar" id="drawToolbar">
      <button class="active" onclick="setDrawColor('#ffffff',this)">‚ö™</button>
      <button onclick="setDrawColor('#00e5ff',this)">üîµ</button>
      <button onclick="setDrawColor('#ff6b9d',this)">üî¥</button>
      <button onclick="setDrawColor('#fbbf24',this)">üü°</button>
      <button onclick="setDrawSize(3,this)" data-group="size" class="active">–¢–æ–Ω–∫–∞—è</button>
      <button onclick="setDrawSize(8,this)" data-group="size">–¢–æ–ª—Å—Ç–∞—è</button>
      <button onclick="clearDrawCanvas()">‚úï</button>
    </div>
    <canvas class="draw-canvas" id="drawCanvas"></canvas>
  </div>
  <div class="btn-row"><button class="btn" onclick="finishDraw()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-assembly">
  <div class="module-tag">–ú–æ–¥—É–ª—å 10 ¬∑ –ö–æ–º–ø–æ–∑–∏—Ü–∏—è</div>
  <div class="module-title">–°–æ–±–µ—Ä–∏ –º–∞–∫–µ—Ç</div>
  <div class="module-desc">–ù–∞–∂–º–∏ –Ω–∞ –±–ª–æ–∫–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ –º–∞–∫–µ—Ç –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</div>
  <div class="assembly-area">
    <div class="assembly-palette"><div class="assembly-palette-title">–ë–ª–æ–∫–∏</div><div class="assembly-blocks" id="asmBlocks"></div></div>
    <div class="assembly-canvas" id="asmCanvas"><div class="assembly-canvas-title">–ú–∞–∫–µ—Ç –ª–µ–Ω–¥–∏–Ω–≥–∞</div></div>
  </div>
  <div class="btn-row"><button class="btn" onclick="finishAssembly()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-color">
  <div class="module-tag">–ú–æ–¥—É–ª—å 11 ¬∑ –¶–≤–µ—Ç</div>
  <div class="module-title">–í—ã–±–µ—Ä–∏ –ø–∞–ª–∏—Ç—Ä—É</div>
  <div class="module-desc">–ö–∞–∫–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥–æ–π–¥—ë—Ç –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–µ–¥–∏—Ç–∞—Ü–∏–∏?</div>
  <div class="color-options" id="colorOpts"></div>
  <div class="btn-row"><button class="btn" id="colorNext" disabled onclick="finishColor()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: COLOR MEMORY -->
<div class="screen" id="screen-colormemory">
  <div class="module-tag">–ú–æ–¥—É–ª—å 12 ¬∑ –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–º—è—Ç—å</div>
  <div class="module-title">–ó–∞–ø–æ–º–Ω–∏ –ø–∞–ª–∏—Ç—Ä—É</div>
  <div class="module-desc">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî –ø–∞–ª–∏—Ç—Ä–∞ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã. –ü–æ—Ç–æ–º –≤—ã–±–µ—Ä–∏ –µ—ë –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.</div>
  <div id="cmArea">
    <button class="btn" id="cmRevealBtn" onclick="cmReveal()">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã</button>
    <div class="cm-palette" id="cmPalette" style="display:none"></div>
    <div class="cm-options" id="cmOptions" style="display:none"></div>
  </div>
  <div class="btn-row"><button class="btn" id="cmNext" disabled onclick="finishColorMemory()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-font">
  <div class="module-tag">–ú–æ–¥—É–ª—å 13 ¬∑ –®—Ä–∏—Ñ—Ç—ã</div>
  <div class="module-title">–ü–æ–¥–±–µ—Ä–∏ —à—Ä–∏—Ñ—Ç</div>
  <div class="module-desc">–ö–∞–∫–∞—è –ø–∞—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –ª—É—á—à–µ –ø–æ–¥–æ–π–¥—ë—Ç –¥–ª—è —Å–∞–π—Ç–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π —Ñ–∏—Ä–º—ã?</div>
  <div class="font-pairs" id="fontPairs"></div>
  <div class="btn-row"><button class="btn" id="fontNext" disabled onclick="finishFont()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-spot">
  <div class="module-tag">–ú–æ–¥—É–ª—å 14 ¬∑ –í–Ω–∏–º–∞–Ω–∏–µ –∫ –¥–µ—Ç–∞–ª—è–º</div>
  <div class="module-title">–ù–∞–π–¥–∏ –æ—à–∏–±–∫—É</div>
  <div class="module-desc">–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π 6 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –í –æ–¥–Ω–æ–º –∏–∑ –Ω–∏—Ö ‚Äî –≥—Ä—É–±–∞—è –¥–∏–∑–∞–π–Ω-–æ—à–∏–±–∫–∞. –ù–∞–π–¥–∏ –∏ –Ω–∞–∂–º–∏ –Ω–∞ –Ω–µ–≥–æ.</div>
  <div class="spot-workspace" id="spotItems"></div>
  <div class="btn-row"><button class="btn" id="spotNext" disabled onclick="finishSpot()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-proportion">
  <div class="module-tag">–ú–æ–¥—É–ª—å 15 ¬∑ –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏</div>
  <div class="module-title">–ù–∞–π–¥–∏ –∑–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ</div>
  <div class="module-desc">–î–≤–∏–≥–∞–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–ø–æ—Ä—Ü–∏—é –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞</div>
  <div class="proportion-workspace">
    <canvas class="proportion-canvas" id="propCanvas"></canvas>
    <div class="proportion-value" id="propValue">50 : 50</div>
    <div class="proportion-hint">‚Üê –¥–≤–∏–≥–∞–π ‚Üí</div>
  </div>
  <div class="btn-row"><button class="btn" onclick="finishProportion()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: SPATIAL THINKING -->
<div class="screen" id="screen-spatial">
  <div class="module-tag">–ú–æ–¥—É–ª—å 16 ¬∑ –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</div>
  <div class="module-title">–ü—Ä–µ–¥—Å—Ç–∞–≤—å –≤ 3D</div>
  <div class="module-desc">–ö–∞–∫–æ–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—É—á–∏—Ç—Å—è –∏–∑ —ç—Ç–æ–π —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏?</div>
  <div class="spatial-unfold" id="spatialUnfold"></div>
  <div class="spatial-options" id="spatialOpts"></div>
  <div class="btn-row"><button class="btn" id="spatialNext" disabled onclick="finishSpatial()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: STYLE VS FUNCTION -->
<div class="screen" id="screen-stylefunction">
  <div class="module-tag">–ú–æ–¥—É–ª—å 17 ¬∑ –°—Ç–∏–ª—å –∏ —Ñ—É–Ω–∫—Ü–∏—è</div>
  <div class="module-title">–ß—Ç–æ –≤–∞–∂–Ω–µ–µ?</div>
  <div class="module-desc" id="sfDesc"></div>
  <div class="sf-pair" id="sfPair"></div>
  <div class="sf-contexts" id="sfContexts"></div>
  <div class="btn-row"><button class="btn" id="sfNext" disabled onclick="finishStyleFunction()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<!-- SCREEN: ROLE -->
<div class="screen" id="screen-role">
  <div class="module-tag">–ú–æ–¥—É–ª—å 18 ¬∑ –†–æ–ª—å</div>
  <div class="module-title">–ö—Ç–æ —Ç—ã –≤ –∫–æ–º–∞–Ω–¥–µ?</div>
  <div class="module-desc">–î–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî –≤—ã–±–µ—Ä–∏ —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —Ç–µ–±–µ –±–ª–∏–∂–µ –≤ –∫–∞–∂–¥–æ–º</div>
  <div id="roleContainer"></div>
  <div class="btn-row"><button class="btn" id="roleNext" disabled onclick="finishRole()">–î–∞–ª–µ–µ ‚Üí</button></div>
</div>

<div class="screen" id="screen-dream">
  <div class="module-tag">–ú–æ–¥—É–ª—å 19 ¬∑ –ú–µ—á—Ç–∞</div>
  <div class="module-title">–ü—Ä–æ–µ–∫—Ç –º–µ—á—Ç—ã</div>
  <div class="module-desc">–ü–æ–ª–Ω–∞—è —Å–≤–æ–±–æ–¥–∞! –í—ã–±–µ—Ä–∏ 2 –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ</div>
  <div class="choice-grid" id="dreamGrid"></div>
  <div class="btn-row"><button class="btn" id="dreamNext" disabled onclick="showResults()">–£–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí</button></div>
</div>

<!-- SCREEN: RESULTS -->
<div class="screen" id="screen-results">
  <div class="hero">
    <div class="results-container">
      <div class="hero-inner reveal">
        <div class="hero-left">
          <div class="hero-class" id="heroClass"></div>
          <p class="hero-desc" id="heroDesc"></p>
        </div>
        <div class="hero-right"><div class="hero-avatar-wrap" id="avatarWrap" style="display:none"><img class="tg-avatar" id="tgAvatar"><div class="hero-avatar-name" id="tgName"></div></div><div class="hero-icon" id="heroIcon"></div></div>
      </div>
    </div>
  </div>
  <div class="results-container">
    <hr class="divider">
    <div class="level-section reveal">
      <div class="level-grid">
        <div class="lvl-badge" id="lvlBadge"></div>
        <div class="lvl-info"><div class="lvl-name" id="lvlName"></div><div class="lvl-sub" id="lvlSub"></div></div>
        <div class="xp-area"><div class="xp-meta"><span>–û–ø—ã—Ç</span><span id="xpText"></span></div><div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div></div>
      </div>
      <div class="lvl-scale"><div class="lvl-pips" id="lvlPips"></div><div class="lvl-labels"><span>1 ‚Äî –ù–æ–≤–∏—á–æ–∫</span><span>4 ‚Äî –ü—Ä–∞–∫—Ç–∏–∫</span><span>7 ‚Äî –≠–∫—Å–ø–µ—Ä—Ç</span><span>10 ‚Äî –õ–µ–≥–µ–Ω–¥–∞</span></div></div>
      <div class="ach-row" id="achRow"></div>
    </div>
    <hr class="divider">
    <div class="section reveal">
      <div class="section-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
      <div class="section-title">–¢–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</div>
      <div class="radar-grid">
        <div class="radar-card"><h3>–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º</h3><canvas id="radarDir"></canvas></div>
        <div class="radar-card"><h3>–°–∫–∏–ª–ª—ã</h3><canvas id="radarSkills"></canvas></div>
      </div>
    </div>
    <hr class="divider">
    <div class="section reveal">
      <div class="section-label">–ü—Ä–æ—Ñ–Ω–∞–≤–∏–≥–∞—Ü–∏—è</div>
      <div class="section-title">–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è</div>
      <div class="flow-card"><div class="flow-canvas-wrap"><canvas id="flowCanvas"></canvas></div></div>
    </div>
    <hr class="divider">
    <div class="section reveal">
      <div class="section-label">–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞</div>
      <div class="section-title">–í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–π</div>
      <div class="demand-grid" id="demandGrid"></div>
    </div>
    <hr class="divider">
    <div class="share-section reveal">
      <div class="share-title" id="shareTitle"></div>
      <button class="btn-pill" onclick="shareResult()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</button>
    </div>
  </div>
</div>

<script>
// ===== TELEGRAM WEB APP =====
const tg = window.Telegram && Telegram.WebApp;
if (tg) { tg.ready(); tg.expand(); }

// ===== STATE =====
const S = { edu:null, scores:{scale:50,material:50,thinking:50,comm:50,role:50}, achievements:[] };
const screens = ['screen-welcome','screen-edu','screen-selfassess','screen-kerning','screen-choice','screen-moodboard','screen-materials','screen-case','screen-empathy','screen-draw','screen-assembly','screen-color','screen-colormemory','screen-font','screen-spot','screen-proportion','screen-spatial','screen-stylefunction','screen-role','screen-dream','screen-results'];
let currentScreen = 'screen-welcome';
const screenHistory = [];

// ===== XP SYSTEM =====
const XP = { total:0, level:1, prevAchCount:0 };
const levelNames = ['','–ù–æ–≤–∏—á–æ–∫','–£—á–µ–Ω–∏–∫','–ü–æ–¥–º–∞—Å—Ç–µ—Ä—å–µ','–ü—Ä–∞–∫—Ç–∏–∫','–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç','–ú–∞—Å—Ç–µ—Ä','–≠–∫—Å–ø–µ—Ä—Ç','–ü—Ä–æ—Ñ–∏','–í–∏—Ä—Ç—É–æ–∑','–õ–µ–≥–µ–Ω–¥–∞'];
const xpPerLevel = [0,0,50,120,200,300,420,560,720,900,1000];
const levelSubs = ['','–¢–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å –ø—É—Ç—å','–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ –≤ –¥–∏–∑–∞–π–Ω–µ','–§–æ—Ä–º–∏—Ä—É–µ—à—å —Å–≤–æ–π –≤–∑–≥–ª—è–¥','–†–∞—Å—Ç—ë—à—å –∫–∞–∫ –¥–∏–∑–∞–π–Ω–µ—Ä','–°–∏–ª—å–Ω—ã–µ –∑–∞–¥–∞—Ç–∫–∏ –∏ –≤–∫—É—Å','–£–≤–µ—Ä–µ–Ω–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ —Ñ–æ—Ä–º—ã','–í—ã–¥–∞—é—â–∏–µ—Å—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏','–ú–∞—Å—Ç–µ—Ä—Å–∫–æ–µ –≤–ª–∞–¥–µ–Ω–∏–µ','–í–∏—Ä—Ç—É–æ–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥','–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å'];

function calcLevel(xp){for(let i=xpPerLevel.length-1;i>=1;i--){if(xp>=xpPerLevel[i])return i}return 1}
function xpProgress(xp,lvl){if(lvl>=10)return 100;const cur=xpPerLevel[lvl],next=xpPerLevel[lvl+1];return((xp-cur)/(next-cur))*100}

function showHud(){document.getElementById('xpHud').classList.add('visible')}
function updateHud(){
  const lvl=calcLevel(XP.total);const oldLvl=XP.level;const leveled=lvl>oldLvl;const fill=document.getElementById('hudFill');
  if(leveled){fill.style.width='100%';setTimeout(()=>{fill.style.transition='none';fill.style.width='0%';XP.level=lvl;document.getElementById('hudLvl').textContent=lvl;document.getElementById('hudName').textContent=levelNames[lvl];document.getElementById('hudXp').textContent=XP.total+' XP';requestAnimationFrame(()=>{fill.style.transition='width .8s cubic-bezier(.4,0,.2,1)';fill.style.width=xpProgress(XP.total,lvl)+'%'})},600)}
  else{XP.level=lvl;document.getElementById('hudLvl').textContent=lvl;document.getElementById('hudName').textContent=levelNames[lvl];document.getElementById('hudXp').textContent=XP.total+' XP';fill.style.width=xpProgress(XP.total,lvl)+'%'}
  return leveled;
}

function awardXP(amount,moduleName,accuracy,nextScreen){
  XP.total+=amount;const leveled=updateHud();
  const newAch=S.achievements.slice(XP.prevAchCount);XP.prevAchCount=S.achievements.length;
  const popup=document.getElementById('xpPopup');
  document.getElementById('popupXp').textContent='+'+amount+' XP';
  document.getElementById('popupAcc').textContent=accuracy!=null?Math.round(accuracy)+'% —Ç–æ—á–Ω–æ—Å—Ç—å':'';
  document.getElementById('popupAcc').style.display=accuracy!=null?'block':'none';
  document.getElementById('popupAch').textContent=newAch.length?'üèÖ '+newAch.join(', '):'';
  document.getElementById('popupAch').style.display=newAch.length?'block':'none';
  document.getElementById('popupLvl').style.display=leveled?'block':'none';
  const accBar=document.getElementById('popupAccBar');
  if(accuracy!=null){accBar.style.display='block';const fill=document.getElementById('popupAccFill');fill.style.width='0%';const hue=accuracy<40?0:accuracy<70?40:150;fill.style.background='hsl('+hue+',80%,55%)';setTimeout(()=>{fill.style.width=Math.round(accuracy)+'%'},100)}else{accBar.style.display='none'}
  popup.classList.add('show');
  const delay=leveled?3200:2500;
  setTimeout(()=>{popup.classList.remove('show');if(nextScreen)setTimeout(()=>go(nextScreen),300)},delay);
}

// ===== NAVIGATION =====
function go(id){
  if(currentScreen!=='screen-welcome')screenHistory.push(currentScreen);
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  // Lock/unlock scroll for drawing screens
  if(id==='screen-draw'||id==='screen-proportion'||id==='screen-kerning'){document.body.classList.add('no-scroll')}else{document.body.classList.remove('no-scroll')}
  window.scrollTo(0,0);currentScreen=id;
  const idx=screens.indexOf(id);
  document.getElementById('progressBar').style.width=((idx/(screens.length-1))*100)+'%';
  // TG BackButton
  if(tg){
    if(id==='screen-welcome'){tg.BackButton.hide()}else{tg.BackButton.show()}
    if(id==='screen-results'){tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å');tg.MainButton.show()}else{tg.MainButton.hide()}
  }
  // Init screens
  if(id==='screen-selfassess')initSelfAssess();
  if(id==='screen-kerning')initKerning();
  if(id==='screen-choice')initChoice();
  if(id==='screen-moodboard')initMoodboard();
  if(id==='screen-case')initCase();
  if(id==='screen-draw')initDraw();
  if(id==='screen-assembly')initAssembly();
  if(id==='screen-materials')initMaterials();
  if(id==='screen-empathy')initEmpathy();
  if(id==='screen-color')initColor();
  if(id==='screen-colormemory')initColorMemory();
  if(id==='screen-font')initFont();
  if(id==='screen-spot')initSpot();
  if(id==='screen-proportion')initProportion();
  if(id==='screen-spatial')initSpatial();
  if(id==='screen-stylefunction')initStyleFunction();
  if(id==='screen-role')initRole();
  if(id==='screen-dream')initDream();
  if(id==='screen-results')initResults();
}

if(tg){
  tg.BackButton.onClick(()=>{if(screenHistory.length){const prev=screenHistory.pop();document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(prev).classList.add('active');window.scrollTo(0,0);currentScreen=prev;if(prev==='screen-welcome')tg.BackButton.hide()}});
  tg.MainButton.onClick(()=>tg.close());
}

function selectCard(el,group){
  el.closest('.card-grid').querySelectorAll('.card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  if(group==='edu'){S.edu=el.dataset.v;document.getElementById('eduNext').disabled=false;showHud();awardXP(10,'–°—Ç–∞—Ä—Ç',null,null)}
}

// ===== 0. SELF-ASSESSMENT (forced-choice pairs) =====
const saPairs=[
  {a:'–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –∏ –æ–±—ä—ë–º–∞–º–∏',b:'–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–æ–π',aAxes:{scale:12},bAxes:{scale:-12,comm:-8}},
  {a:'–ú–Ω–µ –±–ª–∏–∂–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî —Ç–∫–∞–Ω—å, –¥–µ—Ä–µ–≤–æ, –º–µ—Ç–∞–ª–ª',b:'–ú–Ω–µ –±–ª–∏–∂–µ —ç–∫—Ä–∞–Ω –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã',aAxes:{material:14},bAxes:{material:-14}},
  {a:'–î–ª—è –º–µ–Ω—è –≤–∞–∂–Ω–µ–µ, —á—Ç–æ–±—ã –¥–∏–∑–∞–π–Ω —Ä–µ—à–∞–ª –∑–∞–¥–∞—á—É',b:'–î–ª—è –º–µ–Ω—è –≤–∞–∂–Ω–µ–µ, —á—Ç–æ–±—ã –¥–∏–∑–∞–π–Ω –≤—ã–∑—ã–≤–∞–ª —ç–º–æ—Ü–∏—é',aAxes:{thinking:-12},bAxes:{thinking:12}},
  {a:'–î–∏–∑–∞–π–Ω ‚Äî —ç—Ç–æ –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –∏ —Å–º—ã—Å–ª',b:'–î–∏–∑–∞–π–Ω ‚Äî —ç—Ç–æ –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ —Ñ–æ—Ä–º–∞ –∏ —ç—Å—Ç–µ—Ç–∏–∫–∞',aAxes:{comm:-12},bAxes:{comm:12}},
  {a:'–•–æ—á—É —Å–∞–º(–∞) —Å–æ–∑–¥–∞–≤–∞—Ç—å ‚Äî —Ä–∏—Å–æ–≤–∞—Ç—å, –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å, —à–∏—Ç—å',b:'–•–æ—á—É —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é',aAxes:{role:-14},bAxes:{role:20}},
  {a:'–ú–Ω–µ –±–ª–∏–∂–µ –±–æ–ª—å—à–∏–µ –º–∞—Å—à—Ç–∞–±—ã ‚Äî –∑–¥–∞–Ω–∏—è, –≥–æ—Ä–æ–¥–∞, —Å—Ä–µ–¥–∞',b:'–ú–Ω–µ –±–ª–∏–∂–µ –º–∞–ª—ã–µ –º–∞—Å—à—Ç–∞–±—ã ‚Äî —É–∫—Ä–∞—à–µ–Ω–∏—è, –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã, —É–ø–∞–∫–æ–≤–∫–∞',aAxes:{scale:10,material:5},bAxes:{scale:-10,material:8,thinking:5}},
  {a:'–Ø —Å–∫–æ—Ä–µ–µ –ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç ‚Äî –¥–æ–≤–æ–∂—É –¥–æ –∏–¥–µ–∞–ª–∞',b:'–Ø —Å–∫–æ—Ä–µ–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π ‚Äî –ø—Ä–∏–¥—É–º–∞—é 100 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤',aAxes:{thinking:-8,comm:-5},bAxes:{thinking:8,role:5}}
];
let saAnswers=[];
function initSelfAssess(){
  saAnswers=new Array(saPairs.length).fill(null);
  const cont=document.getElementById('saContainer');
  cont.innerHTML=saPairs.map((p,i)=>'<div class="sa-pair"><div class="sa-counter">–ü–∞—Ä–∞ '+(i+1)+' –∏–∑ '+saPairs.length+'</div><div class="sa-options"><div class="sa-opt" data-pair="'+i+'" data-side="a" onclick="pickSA(this)">'+p.a+'</div><div class="sa-opt" data-pair="'+i+'" data-side="b" onclick="pickSA(this)">'+p.b+'</div></div></div>').join('');
  document.getElementById('saNext').disabled=true;
}
function pickSA(el){
  const pair=+el.dataset.pair,side=el.dataset.side;
  el.parentElement.querySelectorAll('.sa-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  saAnswers[pair]=side;
  document.getElementById('saNext').disabled=saAnswers.includes(null);
}
function finishSelfAssess(){
  saAnswers.forEach((side,i)=>{
    const axes=side==='a'?saPairs[i].aAxes:saPairs[i].bAxes;
    Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});
  });
  S.achievements.push('–°–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ');
  awardXP(50,'–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞',null,'screen-kerning');
}

// ===== 1. KERNING =====
function initKerning(){
  const word='DESIGN',offsets=[0,12,-9,7,-5,0],movable=[1,2,3,4];
  const container=document.getElementById('kerningWord');container.innerHTML='';
  word.split('').forEach((ch,i)=>{
    const span=document.createElement('span');span.className='kerning-letter'+(movable.includes(i)?'':' fixed');span.textContent=ch;span.style.marginLeft=offsets[i]+'px';span.dataset.offset=offsets[i];
    if(movable.includes(i)){let sx,sm;span.addEventListener('pointerdown',e=>{e.preventDefault();span.setPointerCapture(e.pointerId);sx=e.clientX;sm=parseInt(span.style.marginLeft)||0;span.classList.add('dragging');const move=e2=>{const dx=e2.clientX-sx;const v=Math.max(-20,Math.min(20,sm+dx));span.style.marginLeft=v+'px';span.dataset.offset=v};const up=()=>{span.classList.remove('dragging');span.removeEventListener('pointermove',move);span.removeEventListener('pointerup',up)};span.addEventListener('pointermove',move);span.addEventListener('pointerup',up)})}
    container.appendChild(span);
  });
}
function finishKerning(){
  const letters=document.querySelectorAll('#kerningWord .kerning-letter:not(.fixed)');let totalErr=0;
  letters.forEach(l=>{totalErr+=Math.abs(parseInt(l.dataset.offset)||0)});
  const acc=Math.max(0,100-(totalErr/letters.length)*5);
  S.scores.comm-=(acc-50)*0.3;S.scores.thinking-=(acc-50)*0.2;
  if(acc>80)S.achievements.push('–ú–∞—Å—Ç–µ—Ä –∫–µ—Ä–Ω–∏–Ω–≥–∞');
  awardXP(acc>80?80:50,'–ö–µ—Ä–Ω–∏–Ω–≥',acc,'screen-choice');
}

// ===== 2. CHOICE =====
let choiceSel=-1,argSel=-1;
const logoSvg1="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 150"><rect width="200" height="150" fill="#111115"/><circle cx="100" cy="55" r="30" stroke="#00e5ff" stroke-width="2.5" fill="none"/><path d="M85 55 C85 42 100 30 100 30 C100 30 115 42 115 55" stroke="#00e5ff" stroke-width="2.5" fill="none"/><circle cx="100" cy="50" r="5" fill="#00e5ff" opacity="0.6"/><line x1="70" y1="97" x2="130" y2="97" stroke="#444" stroke-width="1"/><text x="100" y="120" font-family="sans-serif" font-size="14" fill="#999" text-anchor="middle" letter-spacing="6">–ó–ï–†–ù–û</text></svg>');
const logoSvg2="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 150"><rect width="200" height="150" fill="#111115"/><ellipse cx="100" cy="55" rx="38" ry="32" fill="#ff6b9d" opacity="0.35"/><ellipse cx="85" cy="48" rx="22" ry="20" fill="#fbbf24" opacity="0.45"/><ellipse cx="115" cy="48" rx="20" ry="24" fill="#b388ff" opacity="0.4"/><path d="M75 65 Q100 88 125 65" stroke="#fff" stroke-width="3" fill="none" stroke-linecap="round"/><text x="100" y="120" font-family="sans-serif" font-size="16" fill="#fff" text-anchor="middle" font-weight="bold">–ó–µ—Ä–Ω–æ</text></svg>');
const logoSvg3="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 150"><rect width="200" height="150" fill="#111115"/><rect x="72" y="28" width="56" height="56" stroke="#00e5ff" stroke-width="2.5" fill="rgba(0,229,255,0.08)" transform="rotate(45 100 56)"/><circle cx="100" cy="56" r="18" stroke="#b388ff" stroke-width="2.5" fill="rgba(179,136,255,0.1)"/><rect x="90" y="46" width="20" height="20" stroke="#4ade80" stroke-width="2" fill="rgba(74,222,128,0.1)"/><text x="100" y="120" font-family="sans-serif" font-size="12" fill="#888" text-anchor="middle" letter-spacing="5">–ó–ï–†–ù–û</text></svg>');
const choiceData={options:[{svg:logoSvg1,label:'–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π',axes:{thinking:-10,comm:-10}},{svg:logoSvg2,label:'–≠–∫—Å–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π',axes:{thinking:15,comm:-5}},{svg:logoSvg3,label:'–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π',axes:{thinking:-5,scale:5}}],arguments:[{text:'–ß–∏—Å—Ç—ã–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π ‚Äî –ª–µ–≥–∫–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å',axes:{comm:-8,thinking:-8}},{text:'–ü–µ—Ä–µ–¥–∞—ë—Ç —ç–º–æ—Ü–∏—é –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É',axes:{thinking:12,comm:5}},{text:'–•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º –Ω–æ—Å–∏—Ç–µ–ª–µ',axes:{thinking:-5,role:8}},{text:'–í—ã–¥–µ–ª—è–µ—Ç—Å—è —Å—Ä–µ–¥–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤',axes:{role:5,comm:-5}}]};
function initChoice(){choiceSel=-1;argSel=-1;document.getElementById('choiceGrid').innerHTML=choiceData.options.map((o,i)=>'<div class="choice-card" data-i="'+i+'" onclick="pickChoice(this)"><div class="choice-img"><img src="'+o.svg+'" alt="'+o.label+'"></div><div class="choice-label">'+o.label+'</div></div>').join('');document.getElementById('argSection').style.display='none';document.getElementById('choiceNext').disabled=true}
function pickChoice(el){document.querySelectorAll('#choiceGrid .choice-card').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');choiceSel=+el.dataset.i;document.getElementById('argGrid').innerHTML=choiceData.arguments.map((a,i)=>'<div class="arg-chip" data-i="'+i+'" onclick="pickArg(this)">'+a.text+'</div>').join('');document.getElementById('argSection').style.display='block'}
function pickArg(el){document.querySelectorAll('#argGrid .arg-chip').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');argSel=+el.dataset.i;document.getElementById('choiceNext').disabled=false}
function finishChoice(){const cAxes=choiceData.options[choiceSel].axes,aAxes=choiceData.arguments[argSel].axes;Object.keys(cAxes).forEach(k=>{S.scores[k]+=cAxes[k]});Object.keys(aAxes).forEach(k=>{S.scores[k]+=aAxes[k]});S.achievements.push('–ù–∞—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π');awardXP(60,'–ù–∞—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—å',null,'screen-moodboard')}

// ===== 2.5. MOODBOARD =====
const I='img/';
const moodItems=[
  {img:I+'119.jpg',label:'–ê–Ω—Ç–∏—á–Ω—ã–µ –∫–æ–ª–æ–Ω–Ω—ã',axes:{scale:8,material:5}},
  {img:I+'83.jpg',label:'–ù–µ–±–æ—Å–∫—Ä—ë–± –Ω–∞ –∑–∞–∫–∞—Ç–µ',axes:{scale:10,material:3}},
  {img:I+'0.jpg',label:'–ß–µ—Ä—Ç—ë–∂ –∏ –ø–ª–∞–Ω',axes:{scale:8,thinking:-6}},
  {img:I+'376.jpg',label:'–£—é—Ç–Ω–∞—è –≥–æ—Å—Ç–∏–Ω–∞—è',axes:{scale:5,material:5,thinking:5}},
  {img:I+'188.jpg',label:'–õ–æ—Ñ—Ç-–∫–∞—Ñ–µ',axes:{scale:5,material:5,thinking:5}},
  {img:I+'48.jpg',label:'–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è',axes:{material:-10,comm:-8}},
  {img:I+'292.jpg',label:'–Ø—Ä–∫–∏–π –ø–ª–∞–∫–∞—Ç',axes:{comm:-8,thinking:8}},
  {img:I+'447.jpg',label:'–ù–µ–æ–Ω–æ–≤–∞—è –≤—ã–≤–µ—Å–∫–∞',axes:{comm:-6,thinking:5,material:-3}},
  {img:I+'15.jpg',label:'–¶–∏—Ñ—Ä–æ–≤–∞—è –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è',axes:{material:-12,thinking:5}},
  {img:I+'366.jpg',label:'–ú–æ–¥–Ω—ã–π –ø–æ–∫–∞–∑',axes:{material:10,thinking:10}},
  {img:I+'160.jpg',label:'–Æ–≤–µ–ª–∏—Ä–Ω–æ–µ —É–∫—Ä–∞—à–µ–Ω–∏–µ',axes:{material:10,thinking:10,scale:-6}},
  {img:I+'164.jpg',label:'–¢–µ–∫—Å—Ç–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω',axes:{material:8,thinking:8}},
  {img:I+'250.jpg',label:'Fashion-–∞–∫—Å–µ—Å—Å—É–∞—Ä',axes:{material:8,thinking:6}},
  {img:I+'96.jpg',label:'–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–æ–µ –∫—Ä–µ—Å–ª–æ',axes:{material:5,scale:3,thinking:-4}},
  {img:I+'593.jpg',label:'–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç',axes:{material:5,thinking:-8}},
  {img:I+'28.jpg',label:'–ê–≤—Ç–æ—Ä—Å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',axes:{material:5,scale:3,thinking:-3}},
  {img:I+'667.jpg',label:'–í—ã—Å—Ç–∞–≤–æ—á–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ',axes:{role:8,scale:5}},
  {img:I+'42.jpg',label:'–ë—Ä–µ–Ω–¥-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è',axes:{role:10,thinking:-8}},
  {img:I+'169.jpg',label:'–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å',axes:{role:10,comm:-6}},
  {img:I+'24.jpg',label:'–í—ë—Ä—Å—Ç–∫–∞ –∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞',axes:{comm:-8,material:-5}},
  {img:I+'49.jpg',label:'–ó–∞–≥–æ—Ä–æ–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞',axes:{scale:8,material:8}},
  {img:I+'10.jpg',label:'–õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω',axes:{scale:8,material:5}},
  {img:I+'274.jpg',label:'–í–∏—Ç—Ä–∏–Ω–∞ –±—É—Ç–∏–∫–∞',axes:{material:5,thinking:5,comm:-3}},
  {img:I+'659.jpg',label:'–°—Ü–µ–Ω–æ–≥—Ä–∞—Ñ–∏—è',axes:{scale:5,thinking:8,role:3}}
];
let moodSel=[];
function initMoodboard(){
  moodSel=[];
  document.getElementById('moodGrid').innerHTML=moodItems.map((m,i)=>'<div class="mood-item" data-i="'+i+'" onclick="pickMood(this)"><img class="mood-img" src="'+m.img+'" loading="lazy" alt="'+m.label+'"><div class="mood-label">'+m.label+'</div></div>').join('');
  document.getElementById('moodCounter').innerHTML='–í—ã–±—Ä–∞–Ω–æ: <span class="hl">0</span> –∏–∑ 5‚Äì7';
  document.getElementById('moodNext').disabled=true;
}
function pickMood(el){
  const idx=+el.dataset.i;
  const pos=moodSel.indexOf(idx);
  if(pos>-1){moodSel.splice(pos,1);el.classList.remove('selected')}
  else if(moodSel.length<7){moodSel.push(idx);el.classList.add('selected')}
  document.getElementById('moodCounter').innerHTML='–í—ã–±—Ä–∞–Ω–æ: <span class="hl">'+moodSel.length+'</span> –∏–∑ 5‚Äì7';
  document.getElementById('moodNext').disabled=moodSel.length<5;
}
function finishMoodboard(){
  moodSel.forEach(idx=>{
    const axes=moodItems[idx].axes;
    Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});
  });
  S.achievements.push('–ö—É—Ä–∞—Ç–æ—Ä');
  awardXP(65,'–ú—É–¥–±–æ—Ä–¥',null,'screen-materials');
}

// ===== MATERIALS =====
const matData=[
  {id:'wood',img:I+'mat_wood.jpg',label:'–î–µ—Ä–µ–≤–æ',hint:'–¢—ë–ø–ª–æ–µ, –∂–∏–≤–æ–µ, —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–µ',axes:{material:15,scale:5,thinking:-5}},
  {id:'metal',img:I+'mat_metal.jpg',label:'–ú–µ—Ç–∞–ª–ª',hint:'–ü—Ä–æ—á–Ω—ã–π, –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π',axes:{material:5,scale:8,thinking:-10}},
  {id:'fabric',img:I+'mat_fabric.jpg',label:'–¢–∫–∞–Ω—å',hint:'–ú—è–≥–∫–∞—è, –ø–ª–∞—Å—Ç–∏—á–Ω–∞—è',axes:{material:15,thinking:10,scale:-5}},
  {id:'plastic',img:I+'mat_plastic.jpg',label:'–ü–ª–∞—Å—Ç–∏–∫',hint:'–ú–∞—Å—Å–æ–≤—ã–π, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–π',axes:{material:-10,thinking:-5,role:5}},
  {id:'concrete',img:I+'mat_concrete.jpg',label:'–ë–µ—Ç–æ–Ω',hint:'–ú–æ–Ω—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π, –±—Ä—É—Ç–∞–ª—å–Ω—ã–π',axes:{material:5,scale:15,thinking:-10}},
  {id:'glass',img:I+'mat_glass.jpg',label:'–°—Ç–µ–∫–ª–æ',hint:'–ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ, —Ö—Ä—É–ø–∫–æ–µ',axes:{material:-5,thinking:5,comm:-5}}
];
let matSel=-1;
function initMaterials(){
  matSel=-1;
  document.getElementById('matGrid').innerHTML=matData.map((m,i)=>'<div class="mat-card" data-i="'+i+'" onclick="pickMat(this)"><div class="mat-swatch"><img src="'+m.img+'" alt="'+m.label+'" style="width:100%;height:100%;object-fit:cover;display:block;border-radius:12px 12px 0 0"></div><div class="mat-label">'+m.label+'</div><div class="mat-hint">'+m.hint+'</div></div>').join('');
  document.getElementById('matNext').disabled=true;
}
function pickMat(el){document.querySelectorAll('.mat-card').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');matSel=+el.dataset.i;document.getElementById('matNext').disabled=false}
function finishMaterials(){const axes=matData[matSel].axes;Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});S.achievements.push('–ú–∞—Ç–µ—Ä–∏–∞–ª–∏—Å—Ç');awardXP(55,'–ú–∞—Ç–µ—Ä–∏–∞–ª—ã',null,'screen-case')}

// ===== 3. CASE =====
const caseOpts=[{icon:'üèó',text:'–ü–µ—Ä–µ–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ ‚Äî –∑–æ–Ω—ã –¥–ª—è —Ç—É—Å–æ–≤–æ–∫, –≥–∞–º–∞–∫–∏, –ø–æ–¥–∏—É–º—ã',axes:{scale:15,material:10}},{icon:'üé®',text:'–Ø—Ä–∫–∞—è –∞–π–¥–µ–Ω—Ç–∏–∫–∞ ‚Äî –º–µ–º—ã, —Å—Ç–∏–∫–µ—Ä—ã, –Ω–∞–≤–∏–≥–∞—Ü–∏—è',axes:{comm:-15,thinking:5,material:-10}},{icon:'üì±',text:'–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äî –∫–≤–µ—Å—Ç—ã, AR —Å –∫–Ω–∏–∂–Ω—ã–º–∏ –≥–µ—Ä–æ—è–º–∏',axes:{material:-20,comm:-10}},{icon:'üëï',text:'–ú–µ—Ä—á ‚Äî —Ö—É–¥–∏, —à–æ–ø–µ—Ä—ã, –∑–Ω–∞—á–∫–∏ –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π',axes:{material:15,thinking:15}},{icon:'ü™ë',text:'–ú–æ–¥—É–ª—å–Ω–∞—è –º–µ–±–µ–ª—å ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤',axes:{scale:5,material:10,thinking:-10}},{icon:'üìä',text:'–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è ‚Äî SMM, –∫–æ–ª–ª–∞–±—ã, –∏–≤–µ–Ω—Ç—ã',axes:{role:25,thinking:-10}}];
function initCase(){document.getElementById('caseOpts').innerHTML=caseOpts.map((o,i)=>'<div class="case-opt" data-i="'+i+'" onclick="pickCase(this)"><div class="opt-icon">'+o.icon+'</div><div class="opt-text">'+o.text+'</div></div>').join('');document.getElementById('caseNext').disabled=true}
function pickCase(el){document.querySelectorAll('#caseOpts .case-opt').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');S._caseSel=+el.dataset.i;document.getElementById('caseNext').disabled=false}
function finishCase(){awardXP(70,'–ö–µ–π—Å',null,'screen-empathy')}

// ===== EMPATHY / UX =====
const empathyData={
  scenario:'–ë–∞–±—É—à–∫–∞ 70 –ª–µ—Ç —Ö–æ—á–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –û–Ω–∞ –ø–ª–æ—Ö–æ –≤–∏–¥–∏—Ç –∏ –ø—É—Ç–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö. –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –µ–π –ø–æ–¥–æ–π–¥—ë—Ç?',
  options:[
    {label:'–ö—Ä—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ + –≥–æ–ª–æ—Å',mockup:'<div style="background:#1a1a2e;border-radius:12px;padding:12px;text-align:center"><div style="width:100%;height:36px;background:#00e5ff;border-radius:18px;display:flex;align-items:center;justify-content:center;margin-bottom:8px"><span style="font-size:16px;font-weight:800;color:#111">–ó–ê–ö–ê–ó–ê–¢–¨</span></div><div style="width:100%;height:36px;background:rgba(0,229,255,0.15);border-radius:18px;display:flex;align-items:center;justify-content:center;gap:6px"><span style="font-size:20px">üéô</span><span style="font-size:14px;color:#00e5ff;font-weight:700">–ì–æ–ª–æ—Å</span></div></div>',axes:{comm:-10,thinking:8,role:5},acc:95},
    {label:'–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥',mockup:'<div style="background:#1a1a2e;border-radius:12px;padding:10px"><div style="height:6px;background:#333;border-radius:3px;width:60%;margin-bottom:6px"></div><div style="display:flex;gap:4px;margin-bottom:6px"><div style="flex:1;height:40px;background:#222;border-radius:6px"></div><div style="flex:1;height:40px;background:#222;border-radius:6px"></div><div style="flex:1;height:40px;background:#222;border-radius:6px"></div></div><div style="height:6px;background:#333;border-radius:3px;width:40%"></div></div>',axes:{comm:5,thinking:-5},acc:30},
    {label:'–ú–∏–Ω–∏–º–∞–ª–∏–∑–º + –∂–µ—Å—Ç—ã',mockup:'<div style="background:#1a1a2e;border-radius:12px;padding:16px;text-align:center"><div style="width:40px;height:40px;border:2px solid #555;border-radius:50%;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:18px">‚Üî</div><div style="font-size:11px;color:#555">—Å–≤–∞–π–ø –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</div></div>',axes:{thinking:5,comm:5,material:-5},acc:20},
    {label:'–ß–∞—Ç-–±–æ—Ç –ø–æ–º–æ—â–Ω–∏–∫',mockup:'<div style="background:#1a1a2e;border-radius:12px;padding:10px"><div style="background:#2a2a3e;border-radius:10px 10px 10px 2px;padding:8px;margin-bottom:6px;font-size:11px;color:#aaa">–ö–∞–∫–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ –∏—â–µ—Ç–µ?</div><div style="background:rgba(0,229,255,0.1);border-radius:10px 10px 2px 10px;padding:8px;margin-left:auto;max-width:70%;font-size:11px;color:#00e5ff">–ê—Å–ø–∏—Ä–∏–Ω</div></div>',axes:{comm:-8,role:8,thinking:-3},acc:60}
  ]
};
let empSel=-1;
function initEmpathy(){
  empSel=-1;
  document.getElementById('empathyDesc').textContent=empathyData.scenario;
  document.getElementById('empathyOpts').innerHTML=empathyData.options.map((o,i)=>'<div class="empathy-opt" data-i="'+i+'" onclick="pickEmpathy(this)"><div class="empathy-mockup">'+o.mockup+'</div><div class="empathy-label">'+o.label+'</div></div>').join('');
  document.getElementById('empathyNext').disabled=true;
}
function pickEmpathy(el){document.querySelectorAll('.empathy-opt').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');empSel=+el.dataset.i;document.getElementById('empathyNext').disabled=false}
function finishEmpathy(){const o=empathyData.options[empSel];Object.keys(o.axes).forEach(k=>{S.scores[k]+=o.axes[k]});if(empSel===0)S.achievements.push('–≠–º–ø–∞—Ç');awardXP(empSel===0?80:50,'–≠–º–ø–∞—Ç–∏—è',o.acc,'screen-draw')}

// ===== 4. DRAWING =====
let drawCtx,drawColor='#ffffff',drawSize=3,isDrawing=false,drawW=600,drawH=400;
function initDraw(){
  const c=document.getElementById('drawCanvas');const wrap=c.parentElement;
  drawW=Math.min(600,wrap.clientWidth-40);drawH=Math.round(drawW*0.667);
  const dpr=window.devicePixelRatio||1;c.width=drawW*dpr;c.height=drawH*dpr;c.style.width=drawW+'px';c.style.height=drawH+'px';
  drawCtx=c.getContext('2d');drawCtx.scale(dpr,dpr);drawCtx.fillStyle='#1a1a1a';drawCtx.fillRect(0,0,drawW,drawH);drawCtx.lineCap='round';drawCtx.lineJoin='round';
  c.addEventListener('pointerdown',e=>{e.preventDefault();isDrawing=true;drawCtx.beginPath();const r=c.getBoundingClientRect();const sx=(e.clientX-r.left)*(drawW/r.width);const sy=(e.clientY-r.top)*(drawH/r.height);drawCtx.moveTo(sx,sy)});
  c.addEventListener('pointermove',e=>{e.preventDefault();if(!isDrawing)return;const r=c.getBoundingClientRect();drawCtx.strokeStyle=drawColor;drawCtx.lineWidth=drawSize;const sx=(e.clientX-r.left)*(drawW/r.width);const sy=(e.clientY-r.top)*(drawH/r.height);drawCtx.lineTo(sx,sy);drawCtx.stroke()});
  c.addEventListener('pointerup',e=>{e.preventDefault();isDrawing=false});c.addEventListener('pointerleave',()=>{isDrawing=false});
  c.addEventListener('touchmove',e=>{e.preventDefault()},{passive:false});
}
function setDrawColor(c,btn){drawColor=c;document.querySelectorAll('#drawToolbar button:not([data-group])').forEach(b=>b.classList.remove('active'));btn.classList.add('active')}
function setDrawSize(s,btn){drawSize=s;document.querySelectorAll('#drawToolbar button[data-group="size"]').forEach(b=>b.classList.remove('active'));btn.classList.add('active')}
function clearDrawCanvas(){drawCtx.fillStyle='#1a1a1a';drawCtx.fillRect(0,0,drawW,drawH)}
function finishDraw(){
  document.body.classList.remove('no-scroll');
  const c=document.getElementById('drawCanvas');const data=drawCtx.getImageData(0,0,c.width,c.height).data;let drawn=0;
  for(let i=0;i<data.length;i+=16){if(data[i]>30||data[i+1]>30||data[i+2]>30)drawn++}
  if(drawn>200){S.scores.thinking+=10;S.scores.comm-=5;S.achievements.push('–•—É–¥–æ–∂–Ω–∏–∫')}
  awardXP(drawn>200?80:40,'–†–∏—Å–æ–≤–∞–Ω–∏–µ',null,'screen-assembly');
}

// ===== 5. ASSEMBLY (tap-based for mobile) =====
const asmBlockData=[
{id:'nav',label:'–ù–∞–≤–∏–≥–∞—Ü–∏—è',icon:'‚ò∞',wire:'<div style="display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:#1a1a2e;border-radius:6px"><div style="width:50px;height:8px;background:#00e5ff;border-radius:4px"></div><div style="display:flex;gap:10px"><div style="width:28px;height:4px;background:#555;border-radius:2px"></div><div style="width:28px;height:4px;background:#555;border-radius:2px"></div><div style="width:28px;height:4px;background:#555;border-radius:2px"></div></div></div>'},
{id:'hero',label:'–ì–µ—Ä–æ–π-–±–∞–Ω–Ω–µ—Ä',icon:'üñº',wire:'<div style="background:linear-gradient(135deg,#1a1a2e,#2a1a3e);border-radius:8px;padding:14px 16px;text-align:center"><div style="width:60%;height:10px;background:#fff;border-radius:4px;margin:0 auto 8px"></div><div style="width:80%;height:6px;background:#555;border-radius:3px;margin:0 auto 10px"></div><div style="width:80px;height:24px;background:#00e5ff;border-radius:12px;margin:0 auto;display:flex;align-items:center;justify-content:center"><span style="font-size:9px;color:#111;font-weight:700">–ö–ù–û–ü–ö–ê</span></div></div>'},
{id:'features',label:'–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞',icon:'‚≠ê',wire:'<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;padding:8px"><div style="background:#1a1a2e;border-radius:6px;padding:8px;text-align:center"><div style="width:20px;height:20px;background:#b388ff;border-radius:50%;margin:0 auto 4px"></div><div style="width:80%;height:4px;background:#444;border-radius:2px;margin:0 auto"></div></div><div style="background:#1a1a2e;border-radius:6px;padding:8px;text-align:center"><div style="width:20px;height:20px;background:#00e5ff;border-radius:50%;margin:0 auto 4px"></div><div style="width:80%;height:4px;background:#444;border-radius:2px;margin:0 auto"></div></div><div style="background:#1a1a2e;border-radius:6px;padding:8px;text-align:center"><div style="width:20px;height:20px;background:#ff6b9d;border-radius:50%;margin:0 auto 4px"></div><div style="width:80%;height:4px;background:#444;border-radius:2px;margin:0 auto"></div></div></div>'},
{id:'gallery',label:'–ì–∞–ª–µ—Ä–µ—è —Ä–∞–±–æ—Ç',icon:'üé®',wire:'<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:4px;padding:6px"><div style="aspect-ratio:1;background:#2a2a3e;border-radius:4px"></div><div style="aspect-ratio:1;background:#1a2a2e;border-radius:4px"></div><div style="aspect-ratio:1;background:#2a1a2e;border-radius:4px"></div><div style="aspect-ratio:1;background:#2a2a1e;border-radius:4px"></div></div>'},
{id:'testimonials',label:'–û—Ç–∑—ã–≤—ã',icon:'üí¨',wire:'<div style="padding:8px;display:flex;gap:6px"><div style="flex:1;background:#1a1a2e;border-radius:8px;padding:8px"><div style="width:20px;height:20px;background:#555;border-radius:50%;margin-bottom:4px"></div><div style="width:90%;height:4px;background:#333;border-radius:2px;margin-bottom:3px"></div><div style="width:70%;height:4px;background:#333;border-radius:2px"></div></div><div style="flex:1;background:#1a1a2e;border-radius:8px;padding:8px"><div style="width:20px;height:20px;background:#555;border-radius:50%;margin-bottom:4px"></div><div style="width:90%;height:4px;background:#333;border-radius:2px;margin-bottom:3px"></div><div style="width:60%;height:4px;background:#333;border-radius:2px"></div></div></div>'},
{id:'cta',label:'CTA-—Å–µ–∫—Ü–∏—è',icon:'üéØ',wire:'<div style="text-align:center;padding:12px;background:linear-gradient(135deg,rgba(0,229,255,0.08),rgba(179,136,255,0.08));border-radius:8px"><div style="width:50%;height:6px;background:#fff;border-radius:3px;margin:0 auto 8px"></div><div style="width:100px;height:28px;background:#00e5ff;border-radius:14px;margin:0 auto;display:flex;align-items:center;justify-content:center"><span style="font-size:9px;color:#111;font-weight:700">–ó–ê–ü–ò–°–ê–¢–¨–°–Ø</span></div></div>'},
{id:'video',label:'–í–∏–¥–µ–æ',icon:'‚ñ∂Ô∏è',wire:'<div style="background:#1a1a2e;border-radius:8px;padding:20px;text-align:center;position:relative"><div style="width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,0.15);margin:0 auto;display:flex;align-items:center;justify-content:center"><div style="width:0;height:0;border-left:12px solid #fff;border-top:7px solid transparent;border-bottom:7px solid transparent;margin-left:3px"></div></div></div>'},
{id:'footer',label:'–ü–æ–¥–≤–∞–ª',icon:'üìã',wire:'<div style="display:flex;justify-content:space-between;padding:8px 12px;background:#111118;border-radius:6px"><div style="display:flex;flex-direction:column;gap:3px"><div style="width:40px;height:4px;background:#444;border-radius:2px"></div><div style="width:30px;height:4px;background:#333;border-radius:2px"></div></div><div style="display:flex;gap:6px;align-items:center"><div style="width:14px;height:14px;background:#333;border-radius:50%"></div><div style="width:14px;height:14px;background:#333;border-radius:50%"></div><div style="width:14px;height:14px;background:#333;border-radius:50%"></div></div></div>'}
];
let asmOrder=[];
function initAssembly(){
  asmOrder=[];const blocks=document.getElementById('asmBlocks');
  blocks.innerHTML=asmBlockData.map(b=>'<div class="assembly-block" data-id="'+b.id+'" onclick="addBlock(\''+b.id+'\')"><div style="margin-bottom:6px">'+b.wire+'</div><div style="font-size:12px;font-weight:600;text-align:center">'+b.label+'</div></div>').join('');
  document.getElementById('asmCanvas').innerHTML='<div class="assembly-canvas-title">–ú–∞–∫–µ—Ç –ª–µ–Ω–¥–∏–Ω–≥–∞</div><div style="text-align:center;padding:20px;color:var(--muted);font-size:13px">–ù–∞–∂–∏–º–∞–π –±–ª–æ–∫–∏ —Å–ª–µ–≤–∞ ‚Üí</div>';
}
function addBlock(id){
  if(asmOrder.includes(id))return;asmOrder.push(id);const b=asmBlockData.find(x=>x.id===id);
  const el=document.querySelector('.assembly-block[data-id="'+id+'"]');if(el)el.style.display='none';
  const slot=document.createElement('div');slot.className='assembly-slot';slot.innerHTML='<div style="flex:1">'+b.wire+'</div><div style="display:flex;align-items:center;gap:6px;flex-shrink:0"><span style="font-size:11px;color:var(--muted);white-space:nowrap">'+b.label+'</span><span class="remove" onclick="removeBlock(\''+id+'\',this)">‚úï</span></div>';
  document.getElementById('asmCanvas').appendChild(slot);
}
function removeBlock(id,el){asmOrder=asmOrder.filter(x=>x!==id);el.parentElement.remove();const pb=document.querySelector('.assembly-block[data-id="'+id+'"]');if(pb)pb.style.display=''}
function finishAssembly(){
  let score=0;if(asmOrder[0]==='nav')score+=20;if(asmOrder.indexOf('hero')<=1)score+=15;if(asmOrder.indexOf('cta')>=asmOrder.length-3)score+=15;if(asmOrder[asmOrder.length-1]==='footer')score+=20;if(asmOrder.length>=5)score+=10;
  S.scores.comm-=score*0.2;S.scores.role+=score*0.15;if(score>=60)S.achievements.push('–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –º–∞–∫–µ—Ç–æ–≤');
  const asmAcc=Math.min(100,score*1.25);awardXP(score>=60?90:55,'–ö–æ–º–ø–æ–∑–∏—Ü–∏—è',asmAcc,'screen-color');
}

// ===== 6. COLOR =====
const colorPalettes=[{colors:['#1a1a2e','#16213e','#533483','#e94560'],label:'–¢—ë–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç',axes:{thinking:10,comm:-5}},{colors:['#a8e6cf','#dcedc1','#ffd3b6','#ffaaa5'],label:'–ú—è–≥–∫–∞—è –ø–∞—Å—Ç–µ–ª—å',axes:{thinking:-5,material:10}},{colors:['#2d3436','#636e72','#b2bec3','#dfe6e9'],label:'–ú–æ–Ω–æ—Ö—Ä–æ–º —Å–µ—Ä—ã–π',axes:{thinking:-15,role:10}},{colors:['#6c5ce7','#a29bfe','#fd79a8','#fdcb6e'],label:'–Ø—Ä–∫–∏–π –º–∏–∫—Å',axes:{thinking:15,comm:-10}}];
let colorSel=-1;
function initColor(){colorSel=-1;document.getElementById('colorOpts').innerHTML=colorPalettes.map((p,i)=>'<div class="color-opt" data-i="'+i+'" onclick="pickColor(this)"><div class="color-swatches">'+p.colors.map(c=>'<div style="background:'+c+'"></div>').join('')+'</div><div class="color-opt-label">'+p.label+'</div></div>').join('');document.getElementById('colorNext').disabled=true}
function pickColor(el){document.querySelectorAll('.color-opt').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');colorSel=+el.dataset.i;document.getElementById('colorNext').disabled=false}
function finishColor(){const axes=colorPalettes[colorSel].axes;Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});const colorAcc=colorSel===1?95:colorSel===2?60:colorSel===0?45:55;awardXP(60,'–¶–≤–µ—Ç',colorAcc,'screen-colormemory')}

// ===== COLOR MEMORY =====
const cmTarget=['#e94560','#533483','#16213e','#1a1a2e'];
const cmDecoys=[
  ['#e94560','#16213e','#533483','#1a1a2e'],
  ['#ff6b9d','#533483','#16213e','#1a1a2e'],
  ['#e94560','#533483','#1a3a5e','#1a1a2e'],
  ['#e94560','#533483','#16213e','#2a2a4e']
];
let cmSel=-1,cmRevealed=false;
function initColorMemory(){
  cmSel=-1;cmRevealed=false;
  document.getElementById('cmRevealBtn').style.display='inline-flex';
  document.getElementById('cmRevealBtn').disabled=false;
  document.getElementById('cmPalette').style.display='none';
  document.getElementById('cmOptions').style.display='none';
  document.getElementById('cmNext').disabled=true;
  document.getElementById('cmPalette').innerHTML=cmTarget.map(c=>'<div class="cm-swatch" style="background:'+c+'"></div>').join('');
}
function cmReveal(){
  cmRevealed=true;
  document.getElementById('cmRevealBtn').disabled=true;
  document.getElementById('cmPalette').style.display='flex';
  setTimeout(()=>{
    document.getElementById('cmPalette').style.display='none';
    document.getElementById('cmRevealBtn').style.display='none';
    const allOpts=[cmTarget,...cmDecoys];
    // Shuffle
    for(let i=allOpts.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[allOpts[i],allOpts[j]]=[allOpts[j],allOpts[i]]}
    document.getElementById('cmOptions').innerHTML=allOpts.map((pal,i)=>'<div class="cm-opt" data-i="'+i+'" onclick="pickCM(this,'+JSON.stringify(pal).replace(/"/g,"&quot;")+')">'+pal.map(c=>'<div class="cm-swatch" style="background:'+c+'"></div>').join('')+'</div>').join('');
    document.getElementById('cmOptions').style.display='grid';
    window._cmAllOpts=allOpts;
  },3000);
}
function pickCM(el,pal){document.querySelectorAll('.cm-opt').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');cmSel=+el.dataset.i;document.getElementById('cmNext').disabled=false}
function finishColorMemory(){
  const chosen=window._cmAllOpts[cmSel];
  const isCorrect=JSON.stringify(chosen)===JSON.stringify(cmTarget);
  if(isCorrect){S.scores.thinking-=8;S.scores.comm-=5;S.achievements.push('–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–º—è—Ç—å')}
  awardXP(isCorrect?85:40,'–¶–≤–µ—Ç.–ø–∞–º—è—Ç—å',isCorrect?100:25,'screen-font');
}

// ===== 7. FONT =====
const fontData=[{head:'Times New Roman',body:'Georgia',style:'font-family:Times New Roman,serif',label:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞–Ω—Ç–∏–∫–≤–∞',axes:{thinking:-10,role:10}},{head:'Helvetica',body:'Arial',style:'font-family:Helvetica,Arial,sans-serif',label:'–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –≥—Ä–æ—Ç–µ—Å–∫',axes:{thinking:-5,comm:-5}},{head:'Playfair Display',body:'Source Sans Pro',style:'font-family:Georgia,serif;letter-spacing:1px',label:'–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–∞—è –ø–∞—Ä–∞',axes:{thinking:5,material:5}},{head:'Courier New',body:'Courier',style:'font-family:Courier New,monospace',label:'–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π',axes:{thinking:15,material:-10}}];
let fontSel=-1;
function initFont(){fontSel=-1;document.getElementById('fontPairs').innerHTML=fontData.map((f,i)=>'<div class="font-pair" data-i="'+i+'" onclick="pickFont(this)"><div class="font-left"><div class="font-sample" style="'+f.style+';font-size:28px;font-weight:bold">–ê–∞</div></div><div class="font-right"><div class="font-sample" style="'+f.style+';font-size:18px;font-weight:bold">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div><div class="font-sample" style="'+f.style+';font-size:14px;color:var(--muted)">–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç</div><div class="font-name">'+f.label+'</div></div></div>').join('');document.getElementById('fontNext').disabled=true}
function pickFont(el){document.querySelectorAll('.font-pair').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');fontSel=+el.dataset.i;document.getElementById('fontNext').disabled=false}
function finishFont(){const axes=fontData[fontSel].axes;Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});const fontAcc=fontSel===0?92:fontSel===2?78:fontSel===1?55:30;awardXP(60,'–®—Ä–∏—Ñ—Ç—ã',fontAcc,'screen-spot')}

// ===== 8. SPOT ERROR =====
const spotData={items:[
  {html:'<div style="font-family:Gilroy,sans-serif;font-size:16px;font-weight:600;color:#fff;line-height:1.6"><div style="font-size:22px;font-weight:700;margin-bottom:6px">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div><div style="color:#868686;font-size:14px">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º</div></div>',label:'Gilroy ¬∑ 16px',ok:true},
  {html:'<div style="background:#222;border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.12)"><div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#00e5ff,#b388ff);margin-bottom:10px"></div><div style="height:8px;background:rgba(255,255,255,0.15);border-radius:4px;width:80%"></div><div style="height:8px;background:rgba(255,255,255,0.08);border-radius:4px;width:60%;margin-top:6px"></div></div>',label:'–ö–∞—Ä—Ç–æ—á–∫–∞ ¬∑ UI',ok:true},
  {html:'<div style="display:flex;gap:8px;align-items:center"><div style="width:36px;height:36px;border-radius:8px;background:#00e5ff;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;color:#222">–ó</div><div><div style="font-size:14px;font-weight:700;color:#fff">–ö–Ω–æ–ø–∫–∞</div><div style="font-size:11px;color:#868686">border-radius: 8px</div></div></div>',label:'–ö–Ω–æ–ø–∫–∞ ¬∑ –°—Ç–∏–ª—å',ok:true},
  {html:'<div style="font-family:Comic Sans MS,cursive;font-size:15px;color:#fff;line-height:1.6"><div style="font-size:20px;font-weight:700;margin-bottom:6px">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div><div style="color:#868686;font-size:13px;font-family:Comic Sans MS,cursive">–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞–±—Ä–∞–Ω –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–º —à—Ä–∏—Ñ—Ç–æ–º</div></div>',label:'Comic Sans MS',ok:false},
  {html:'<div style="display:flex;gap:12px;align-items:center"><div style="width:48px;height:48px;border-radius:50%;background:rgba(179,136,255,0.15);border:1.5px solid rgba(179,136,255,0.4);display:flex;align-items:center;justify-content:center;font-size:20px">‚ò∞</div><div style="display:flex;gap:6px"><div style="height:3px;width:24px;background:#fff;border-radius:2px"></div><div style="height:3px;width:18px;background:rgba(255,255,255,0.4);border-radius:2px"></div><div style="height:3px;width:24px;background:rgba(255,255,255,0.4);border-radius:2px"></div></div></div>',label:'–ù–∞–≤–∏–≥–∞—Ü–∏—è ¬∑ –ò–∫–æ–Ω–∫–∞',ok:true},
  {html:'<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.3);border-radius:8px;padding:12px;text-align:center"><div style="font-size:18px;font-weight:800;color:#00e5ff">86%</div><div style="font-size:10px;color:#868686;margin-top:2px">–°–ø—Ä–æ—Å</div></div><div style="background:rgba(74,222,128,0.08);border:1px solid rgba(74,222,128,0.3);border-radius:8px;padding:12px;text-align:center"><div style="font-size:18px;font-weight:800;color:#4ade80">+24%</div><div style="font-size:10px;color:#868686;margin-top:2px">–†–æ—Å—Ç</div></div></div>',label:'–ú–µ—Ç—Ä–∏–∫–∏ ¬∑ –î–∞—à–±–æ—Ä–¥',ok:true}
]};
let spotSel=null;
function initSpot(){spotSel=null;document.getElementById('spotItems').innerHTML=spotData.items.map((item,i)=>'<div class="spot-item" data-i="'+i+'" onclick="pickSpot(this)"><div class="spot-preview">'+item.html+'</div><div class="spot-label">'+item.label+'</div></div>').join('');document.getElementById('spotNext').disabled=true}
function pickSpot(el){document.querySelectorAll('.spot-item').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');spotSel=+el.dataset.i;document.getElementById('spotNext').disabled=false}
function finishSpot(){const item=spotData.items[spotSel];if(!item.ok){S.scores.thinking-=10;S.scores.comm-=5;S.achievements.push('–ó–æ—Ä–∫–∏–π –≥–ª–∞–∑')}const spotAcc=!item.ok?100:20;awardXP(!item.ok?80:40,'–î–µ—Ç–∞–ª–∏',spotAcc,'screen-proportion')}

// ===== 9. PROPORTION =====
let propRatio=50,propW=560,propH=200;
function initProportion(){
  propRatio=50;const c=document.getElementById('propCanvas');
  propW=Math.min(560,c.parentElement.clientWidth-40);propH=Math.round(propW*0.357);
  drawProportion();
  const move=e=>{const r=c.getBoundingClientRect();propRatio=Math.max(20,Math.min(80,((e.clientX-r.left)/r.width)*100));drawProportion()};
  c.addEventListener('pointerdown',e=>{move(e);c.setPointerCapture(e.pointerId);c.addEventListener('pointermove',move);c.addEventListener('pointerup',()=>c.removeEventListener('pointermove',move),{once:true})});
}
function drawProportion(){
  const c=document.getElementById('propCanvas');const ctx=c.getContext('2d');const dpr=window.devicePixelRatio||1;
  c.width=propW*dpr;c.height=propH*dpr;c.style.width=propW+'px';c.style.height=propH+'px';ctx.scale(dpr,dpr);
  const W=propW,H=propH,pad=16;const split=pad+(W-2*pad)*(propRatio/100);
  ctx.fillStyle='#1a1a1a';ctx.fillRect(0,0,W,H);
  ctx.fillStyle='rgba(0,229,255,0.15)';ctx.fillRect(pad,pad,split-pad,H-2*pad);ctx.strokeStyle='rgba(0,229,255,0.5)';ctx.lineWidth=1.5;ctx.strokeRect(pad,pad,split-pad,H-2*pad);
  ctx.fillStyle='rgba(179,136,255,0.15)';ctx.fillRect(split,pad,W-pad-split,H-2*pad);ctx.strokeStyle='rgba(179,136,255,0.5)';ctx.strokeRect(split,pad,W-pad-split,H-2*pad);
  ctx.beginPath();ctx.moveTo(split,pad-5);ctx.lineTo(split,H-pad+5);ctx.strokeStyle='#fff';ctx.lineWidth=2;ctx.stroke();
  ctx.beginPath();ctx.arc(split,H/2,8,0,Math.PI*2);ctx.fillStyle='#fff';ctx.fill();
  document.getElementById('propValue').textContent=Math.round(propRatio)+' : '+(100-Math.round(propRatio));
}
function finishProportion(){const golden=61.8;const err=Math.abs(propRatio-golden);const acc=Math.max(0,100-err*3);S.scores.scale+=acc*0.15;S.scores.thinking-=acc*0.1;if(err<5)S.achievements.push('–ó–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ');const propAcc=Math.max(5,Math.round(100-err*2.5));awardXP(err<5?90:err<15?65:40,'–ü—Ä–æ–ø–æ—Ä—Ü–∏–∏',propAcc,'screen-spatial')}

// ===== SPATIAL THINKING =====
const spatialUnfoldSvg='<svg width="200" height="160" viewBox="0 0 200 160" xmlns="http://www.w3.org/2000/svg"><rect x="60" y="0" width="50" height="50" fill="none" stroke="#00e5ff" stroke-width="2" stroke-dasharray="4"/><rect x="60" y="50" width="50" height="50" fill="none" stroke="#00e5ff" stroke-width="2"/><rect x="0" y="50" width="60" height="50" fill="none" stroke="#00e5ff" stroke-width="2" stroke-dasharray="4"/><rect x="110" y="50" width="60" height="50" fill="none" stroke="#00e5ff" stroke-width="2" stroke-dasharray="4"/><rect x="60" y="100" width="50" height="50" fill="none" stroke="#00e5ff" stroke-width="2" stroke-dasharray="4"/><text x="85" y="80" text-anchor="middle" fill="#00e5ff" font-size="10" font-family="sans-serif">–û–°–ù–û–í–ê</text></svg>';
const spatialOpts=[
  {label:'–ö—É–±',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><polygon points="20,25 50,10 70,25 70,55 40,70 20,55" fill="rgba(0,229,255,0.1)" stroke="#00e5ff" stroke-width="1.5"/><line x1="40" y1="40" x2="40" y2="70" stroke="#00e5ff" stroke-width="1" opacity="0.5"/><line x1="40" y1="40" x2="70" y2="25" stroke="#00e5ff" stroke-width="1" opacity="0.5"/><line x1="40" y1="40" x2="20" y2="25" stroke="#00e5ff" stroke-width="1" opacity="0.5"/></svg>',correct:true,axes:{scale:8,thinking:-8}},
  {label:'–ü–∏—Ä–∞–º–∏–¥–∞',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><polygon points="40,10 65,65 15,65" fill="rgba(179,136,255,0.1)" stroke="#b388ff" stroke-width="1.5"/><line x1="40" y1="10" x2="55" y2="45" stroke="#b388ff" stroke-width="1" opacity="0.5"/></svg>',correct:false,axes:{scale:5}},
  {label:'–¶–∏–ª–∏–Ω–¥—Ä',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><ellipse cx="40" cy="20" rx="25" ry="10" fill="none" stroke="#ff6b9d" stroke-width="1.5"/><line x1="15" y1="20" x2="15" y2="60" stroke="#ff6b9d" stroke-width="1.5"/><line x1="65" y1="20" x2="65" y2="60" stroke="#ff6b9d" stroke-width="1.5"/><ellipse cx="40" cy="60" rx="25" ry="10" fill="rgba(255,107,157,0.1)" stroke="#ff6b9d" stroke-width="1.5"/></svg>',correct:false,axes:{thinking:5}},
  {label:'–ü—Ä–∏–∑–º–∞',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><polygon points="40,10 65,30 55,70 25,70 15,30" fill="rgba(251,191,36,0.1)" stroke="#fbbf24" stroke-width="1.5"/><line x1="40" y1="10" x2="40" y2="50" stroke="#fbbf24" stroke-width="1" opacity="0.5"/></svg>',correct:false,axes:{material:5}}
];
let spatSel=-1;
function initSpatial(){
  spatSel=-1;
  document.getElementById('spatialUnfold').innerHTML=spatialUnfoldSvg;
  document.getElementById('spatialOpts').innerHTML=spatialOpts.map((o,i)=>'<div class="spatial-opt" data-i="'+i+'" onclick="pickSpatial(this)">'+o.svg+'<div class="spatial-opt-label">'+o.label+'</div></div>').join('');
  document.getElementById('spatialNext').disabled=true;
}
function pickSpatial(el){document.querySelectorAll('.spatial-opt').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');spatSel=+el.dataset.i;document.getElementById('spatialNext').disabled=false}
function finishSpatial(){
  const o=spatialOpts[spatSel];
  if(o.axes)Object.keys(o.axes).forEach(k=>{S.scores[k]+=o.axes[k]});
  if(o.correct)S.achievements.push('3D-–º—ã—à–ª–µ–Ω–∏–µ');
  awardXP(o.correct?85:45,'–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ',o.correct?100:20,'screen-stylefunction');
}

// ===== STYLE VS FUNCTION =====
const sfChairs={
  a:{label:'–°—Ç—É–ª –ê ‚Äî –î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π',desc:'–ö—Ä–∞—Å–∏–≤—ã–π, –∞–≤—Ç–æ—Ä—Å–∫–∏–π, –Ω–µ—É–¥–æ–±–Ω—ã–π',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><path d="M25,65 L25,35 Q25,15 40,15 Q55,15 55,35 L55,65" fill="none" stroke="#ff6b9d" stroke-width="2"/><line x1="20" y1="65" x2="60" y2="65" stroke="#ff6b9d" stroke-width="2"/><path d="M30,35 Q40,25 50,35" fill="none" stroke="#ff6b9d" stroke-width="1.5" opacity="0.5"/></svg>'},
  b:{label:'–°—Ç—É–ª –ë ‚Äî –≠—Ä–≥–æ–Ω–æ–º–∏—á–Ω—ã–π',desc:'–£–¥–æ–±–Ω—ã–π, –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π, –æ–±—ã—á–Ω—ã–π',svg:'<svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="15" width="30" height="25" rx="3" fill="none" stroke="#00e5ff" stroke-width="2"/><rect x="28" y="40" width="24" height="15" rx="2" fill="none" stroke="#00e5ff" stroke-width="2"/><line x1="28" y1="55" x2="28" y2="70" stroke="#00e5ff" stroke-width="2"/><line x1="52" y1="55" x2="52" y2="70" stroke="#00e5ff" stroke-width="2"/></svg>'}
};
const sfContexts=[
  {label:'–ö–∞—Ñ–µ',q:'–ö–∞–∫–æ–π —Å—Ç—É–ª –ø–æ—Å—Ç–∞–≤–∏—à—å –≤ –º–æ–¥–Ω–æ–º –∫–∞—Ñ–µ?'},
  {label:'–î–æ–º',q:'–ö–∞–∫–æ–π —Å—Ç—É–ª –∫—É–ø–∏—à—å –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞?'},
  {label:'–í—ã—Å—Ç–∞–≤–∫–∞',q:'–ö–∞–∫–æ–π —Å—Ç—É–ª –ø–æ–∫–∞–∂–µ—à—å –Ω–∞ –≤—ã—Å—Ç–∞–≤–∫–µ –¥–∏–∑–∞–π–Ω–∞?'}
];
let sfAnswers=[];
function initStyleFunction(){
  sfAnswers=new Array(sfContexts.length).fill(null);
  document.getElementById('sfDesc').textContent='–î–≤–∞ —Å—Ç—É–ª–∞. –û–¥–∏–Ω –∫—Ä–∞—Å–∏–≤—ã–π, –Ω–æ –Ω–µ—É–¥–æ–±–Ω—ã–π. –î—Ä—É–≥–æ–π —É–¥–æ–±–Ω—ã–π, –Ω–æ –æ–±—ã—á–Ω—ã–π. –ß—Ç–æ –≤—ã–±–µ—Ä–µ—à—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö?';
  document.getElementById('sfPair').innerHTML='<div class="sf-chair">'+sfChairs.a.svg+'<div class="sf-chair-label">'+sfChairs.a.label+'</div><div class="sf-chair-desc">'+sfChairs.a.desc+'</div></div><div class="sf-chair">'+sfChairs.b.svg+'<div class="sf-chair-label">'+sfChairs.b.label+'</div><div class="sf-chair-desc">'+sfChairs.b.desc+'</div></div>';
  document.getElementById('sfContexts').innerHTML=sfContexts.map((c,ci)=>'<div class="sf-context"><div class="sf-context-label">'+c.label+'</div><div class="sf-context-q">'+c.q+'</div><div class="sf-btns"><div class="sf-btn" data-ctx="'+ci+'" data-v="a" onclick="pickSF(this)">–°—Ç—É–ª –ê</div><div class="sf-btn" data-ctx="'+ci+'" data-v="b" onclick="pickSF(this)">–°—Ç—É–ª –ë</div></div></div>').join('');
  document.getElementById('sfNext').disabled=true;
}
function pickSF(el){
  const ctx=+el.dataset.ctx,v=el.dataset.v;
  el.parentElement.querySelectorAll('.sf-btn').forEach(b=>b.classList.remove('selected'));
  el.classList.add('selected');
  sfAnswers[ctx]=v;
  document.getElementById('sfNext').disabled=sfAnswers.includes(null);
}
function finishStyleFunction(){
  const styleCount=sfAnswers.filter(a=>a==='a').length;
  if(styleCount>=2){S.scores.thinking+=10;S.scores.material+=5}
  else{S.scores.thinking-=8;S.scores.role+=5}
  if(styleCount===3)S.achievements.push('–≠—Å—Ç–µ—Ç');
  if(styleCount===0)S.achievements.push('–ü—Ä–∞–≥–º–∞—Ç–∏–∫');
  const sfAcc=Math.round((Math.abs(styleCount-1.5)/1.5)*100);
  awardXP(60,'–°—Ç–∏–ª—å',sfAcc,'screen-role');
}

// ===== 10. ROLE =====
const roleScenarios=[
  {label:'–°—Ü–µ–Ω–∞—Ä–∏–π 1',text:'–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –±–æ–ª—å—à–∏–º –¥–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–æ–º. –ö–∞–∫—É—é —Ä–æ–ª—å –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏?',
    opts:[
      {icon:'‚úèÔ∏è',text:'–†–∏—Å—É—é —ç—Å–∫–∏–∑—ã –∏ –º–∞–∫–µ—Ç—ã ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é –∏–¥–µ–∏',axes:{role:-12,thinking:5}},
      {icon:'üíª',text:'–ü—Ä–æ–µ–∫—Ç–∏—Ä—É—é –≤ 3D –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–µ ‚Äî —Å–æ–∑–¥–∞—é –º–æ–¥–µ–ª–∏',axes:{role:-8,material:5}},
      {icon:'ü§ù',text:'–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é –∫–æ–º–∞–Ω–¥—É –∏ –æ–±—â–∞—é—Å—å —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º',axes:{role:18}},
      {icon:'üîç',text:'–ò—Å—Å–ª–µ–¥—É—é —Ç—Ä–µ–Ω–¥—ã –∏ –≥–æ—Ç–æ–≤–ª—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É',axes:{role:14,thinking:-6}}
    ]},
  {label:'–°—Ü–µ–Ω–∞—Ä–∏–π 2',text:'–ß–µ—Ä–µ–∑ 5 –ª–µ—Ç –≤—ã –≤–∏–¥–∏—Ç–µ —Å–µ–±—è –∫–∞–∫...',
    opts:[
      {icon:'üé®',text:'–°–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä —Å –∞–≤—Ç–æ—Ä—Å–∫–∏–º —Å—Ç–∏–ª–µ–º',axes:{role:-12,thinking:8}},
      {icon:'üè¢',text:'–ê–≤—Ç–æ—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—É–¥–∏–∏ –∏–ª–∏ –±—Ä–µ–Ω–¥–∞',axes:{role:-4,thinking:4}},
      {icon:'üëî',text:'–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä –∫—Ä—É–ø–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞',axes:{role:14}},
      {icon:'üé™',text:'–ö—É—Ä–∞—Ç–æ—Ä –≤—ã—Å—Ç–∞–≤–æ–∫ –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤',axes:{role:18,thinking:-4}}
    ]}
];
let roleAnswers=[];
function initRole(){
  roleAnswers=new Array(roleScenarios.length).fill(null);
  const cont=document.getElementById('roleContainer');
  cont.innerHTML=roleScenarios.map((sc,si)=>'<div class="role-scenario"><div class="role-scenario-label">'+sc.label+'</div><div class="role-scenario-text">'+sc.text+'</div><div class="role-options">'+sc.opts.map((o,oi)=>'<div class="role-opt" data-sc="'+si+'" data-opt="'+oi+'" onclick="pickRole(this)"><div class="opt-icon">'+o.icon+'</div><div>'+o.text+'</div></div>').join('')+'</div></div>').join('');
  document.getElementById('roleNext').disabled=true;
}
function pickRole(el){
  const sc=+el.dataset.sc,opt=+el.dataset.opt;
  el.closest('.role-options').querySelectorAll('.role-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  roleAnswers[sc]=opt;
  document.getElementById('roleNext').disabled=roleAnswers.includes(null);
}
function finishRole(){
  roleAnswers.forEach((optIdx,scIdx)=>{
    const axes=roleScenarios[scIdx].opts[optIdx].axes;
    Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]});
  });
  if(roleAnswers.every(a=>a>=2))S.achievements.push('–õ–∏–¥–µ—Ä');
  if(roleAnswers.every(a=>a<=1))S.achievements.push('–¢–≤–æ—Ä–µ—Ü');
  awardXP(65,'–†–æ–ª—å',null,'screen-dream');
}

// ===== 11. DREAM =====
const dreamProjects=[{img:I+'58.jpg',label:'–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º —É –º–æ—Ä—è',axes:{scale:20,material:15}},{img:I+'366.jpg',label:'–°–æ–∑–¥–∞—Ç—å –±—Ä–µ–Ω–¥ –æ–¥–µ–∂–¥—ã',axes:{material:20,thinking:15}},{img:I+'48.jpg',label:'–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º—É–∑–µ—è',axes:{material:-20,comm:-15}},{img:I+'96.jpg',label:'–õ–∏–Ω–µ–π–∫–∞ –º–µ–±–µ–ª–∏',axes:{material:10,scale:5}},{img:I+'119.jpg',label:'–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤—ã—Å—Ç–∞–≤–∫—É',axes:{role:25,thinking:-5}},{img:I+'160.jpg',label:'–Æ–≤–µ–ª–∏—Ä–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è',axes:{material:20,thinking:20}},{img:I+'188.jpg',label:'–ò–Ω—Ç–µ—Ä—å–µ—Ä —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞',axes:{scale:15,material:10}},{img:I+'15.jpg',label:'AR-–∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è',axes:{material:-15,thinking:10}}];
function initDream(){S._dreamSel=[];document.getElementById('dreamGrid').innerHTML=dreamProjects.map((p,i)=>'<div class="choice-card" data-i="'+i+'" onclick="pickDream(this)"><div class="choice-img"><img src="'+p.img+'" loading="lazy" alt="'+p.label+'"></div><div class="choice-label">'+p.label+'</div></div>').join('');document.getElementById('dreamNext').disabled=true}
function pickDream(el){const idx=+el.dataset.i;const pos=S._dreamSel.indexOf(idx);if(pos>-1){S._dreamSel.splice(pos,1);el.classList.remove('selected')}else if(S._dreamSel.length<2){S._dreamSel.push(idx);el.classList.add('selected')}document.getElementById('dreamNext').disabled=S._dreamSel.length!==2}

// ===== SHOW RESULTS =====
function showResults(){
  if(S._caseSel!==undefined){const axes=caseOpts[S._caseSel].axes;Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]})}
  (S._dreamSel||[]).forEach(idx=>{const axes=dreamProjects[idx].axes;Object.keys(axes).forEach(k=>{S.scores[k]+=axes[k]})});
  Object.keys(S.scores).forEach(k=>{S.scores[k]=Math.max(5,Math.min(95,S.scores[k]))});
  S.achievements.push('–ú–µ—á—Ç–∞—Ç–µ–ª—å');XP.total+=70;updateHud();
  go('screen-results');
}

// ===== RESULTS LOGIC =====
const clusters={
  arch:{name:'–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π\n–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä',icon:'üèõ',profile:[85,75,45,80,20],desc:'–¢—ã –º—ã—Å–ª–∏—à—å –æ–±—ä—ë–º–∞–º–∏ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞–º–∏. –¢–µ–±–µ –≤–∞–∂–Ω–æ, –∫–∞–∫ –∑–¥–∞–Ω–∏–µ –≤—Å—Ç–∞—ë—Ç –≤ –≥–æ—Ä–æ–¥—Å–∫—É—é —Ç–∫–∞–Ω—å, –∫–∞–∫ —Å–≤–µ—Ç –ø–∞–¥–∞–µ—Ç –≤ –∫–æ–º–Ω–∞—Ç—É.'},
  env:{name:'–°–æ–∑–¥–∞—Ç–µ–ª—å\n–ê—Ç–º–æ—Å—Ñ–µ—Ä',icon:'ü™¥',profile:[70,65,60,55,20],desc:'–¢—ã —Å–æ–∑–¥–∞—ë—à—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä—ã ‚Äî —Ç—ã —Å–æ–∑–¥–∞—ë—à—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∂–∏–∑–Ω–∏. –ö–∞–∂–¥–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ ‚Äî –∏—Å—Ç–æ—Ä–∏—è.'},
  graphic:{name:'–¶–∏—Ñ—Ä–æ–≤–æ–π\n–í–∏–∑–∏–æ–Ω–µ—Ä',icon:'üñ•',profile:[35,15,40,20,25],desc:'–¢—ã –¥—É–º–∞–µ—à—å —ç–∫—Ä–∞–Ω–∞–º–∏ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è–º–∏. –ü–∏–∫—Å–µ–ª—å, —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞, –∞–Ω–∏–º–∞—Ü–∏—è ‚Äî —Ç–≤–æ–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.'},
  fashion:{name:'–ú–∞—Å—Ç–µ—Ä\n–ú–∞—Ç–µ—Ä–∏–π',icon:'‚úÇÔ∏è',profile:[15,85,80,75,10],desc:'–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å –º–∞—Ç–µ—Ä–∏–∞–ª –∏ —Ç–µ–ª–æ. –¢–∫–∞–Ω—å, –º–µ—Ç–∞–ª–ª, —Ñ–æ—Ä–º–∞ –∫–æ—Å—Ç—é–º–∞ ‚Äî –¥–∏–∑–∞–π–Ω –Ω–µ–æ—Ç–¥–µ–ª–∏–º –æ—Ç —Ç–∞–∫—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.'},
  product:{name:'–ò–Ω–∂–µ–Ω–µ—Ä\n–§–æ—Ä–º—ã',icon:'ü™ë',profile:[20,55,30,65,20],desc:'–¢—ã —Å–æ–µ–¥–∏–Ω—è–µ—à—å —Ñ—É–Ω–∫—Ü–∏—é –∏ –∫—Ä–∞—Å–æ—Ç—É. –ö–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç ‚Äî –∑–∞–¥–∞—á–∞ –Ω–∞ —Å—Ç—ã–∫–µ –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ —ç—Å—Ç–µ—Ç–∏–∫–∏.'},
  mgmt:{name:'–°—Ç—Ä–∞—Ç–µ–≥\n–î–∏–∑–∞–π–Ω–∞',icon:'üìã',profile:[50,30,15,10,85],desc:'–¢—ã –≤–∏–¥–∏—à—å –¥–∏–∑–∞–π–Ω –∫–∞–∫ —Å–∏—Å—Ç–µ–º—É. –£–ø—Ä–∞–≤–ª—è–µ—à—å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞–µ—à—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.'}
};
const clusterLabels={graphic:'–ì—Ä–∞—Ñ–∏–∫–∞ –∏ —Ü–∏—Ñ—Ä–∞',arch:'–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ',env:'–°—Ä–µ–¥–∞ –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä',fashion:'–ú–æ–¥–∞ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã',product:'–ü—Ä–æ–¥—É–∫—Ç –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏',mgmt:'–ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è'};

function findCluster(){
  const vec=[S.scores.scale,S.scores.material,S.scores.thinking,S.scores.comm,S.scores.role];
  let best=null,bestDist=Infinity,second=null,secondDist=Infinity;
  for(const[key,c]of Object.entries(clusters)){const dist=Math.sqrt(c.profile.reduce((sum,v,i)=>sum+(v-vec[i])**2,0));if(dist<bestDist){second=best;secondDist=bestDist;best=key;bestDist=dist}else if(dist<secondDist){second=key;secondDist=dist}}
  return{primary:best,secondary:second};
}
function computeDirections(){
  const vec=[S.scores.scale,S.scores.material,S.scores.thinking,S.scores.comm,S.scores.role];const result={};
  for(const[key,c]of Object.entries(clusters)){const dist=Math.sqrt(c.profile.reduce((sum,v,i)=>sum+(v-vec[i])**2,0));result[key]=Math.max(5,Math.round(100-dist*0.5))}return result;
}
function computeSkills(){return{space:Math.max(8,Math.min(95,S.scores.scale)),material:Math.max(8,Math.min(95,S.scores.material)),visual:Math.max(8,Math.min(95,Math.round(50+(50-S.scores.thinking)*0.8))),comm:Math.max(8,Math.min(95,Math.round(50+(50-S.scores.comm)*0.7))),strategy:Math.max(8,Math.min(95,S.scores.role))}}

const demandData={
  graphic:[{icon:'üé®',title:'–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω–µ—Ä',vacancies:11200,salary:'95‚Äì180',growth:'+18%',trend:'up',demand:82,skills:['Illustrator','–¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞','–ë—Ä–µ–Ω–¥–∏–Ω–≥','Figma'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[5800,6400,7200,8100,9500,11200]},{icon:'ü•Ω',title:'–î–∏–∑–∞–π–Ω–µ—Ä VR/AR',vacancies:3800,salary:'150‚Äì400',growth:'+42%',trend:'up',demand:76,skills:['Unity','Unreal','3D','Blender'],color:'#b388ff',years:['2020','2021','2022','2023','2024','2025'],chart:[600,900,1400,2100,2700,3800]}],
  arch:[{icon:'üèõ',title:'–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä',vacancies:4500,salary:'100‚Äì280',growth:'+12%',trend:'up',demand:70,skills:['Revit','AutoCAD','BIM','ArchiCAD'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[2800,3100,3400,3700,4100,4500]}],
  env:[{icon:'ü™¥',title:'–î–∏–∑–∞–π–Ω–µ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤',vacancies:4800,salary:'80‚Äì250',growth:'+39%',trend:'up',demand:68,skills:['3ds Max','AutoCAD','SketchUp'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[1800,2100,2600,3100,3500,4800]}],
  fashion:[{icon:'üëó',title:'Fashion-–¥–∏–∑–∞–π–Ω–µ—Ä',vacancies:2900,salary:'80‚Äì300',growth:'+20%',trend:'up',demand:60,skills:['–ö–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–µ','CLO 3D','–¢–µ–∫—Å—Ç–∏–ª—å'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[1400,1600,1900,2200,2500,2900]}],
  product:[{icon:'ü™ë',title:'–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä',vacancies:2400,salary:'90‚Äì250',growth:'+22%',trend:'up',demand:66,skills:['SolidWorks','Rhino','KeyShot'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[1100,1300,1500,1800,2000,2400]},{icon:'üì±',title:'UX/UI –¥–∏–∑–∞–π–Ω–µ—Ä',vacancies:15000,salary:'120‚Äì350',growth:'+35%',trend:'up',demand:90,skills:['Figma','–Æ–∑–∞–±–∏–ª–∏—Ç–∏','–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã'],color:'#b388ff',years:['2020','2021','2022','2023','2024','2025'],chart:[5000,7000,9500,11500,13000,15000]}],
  mgmt:[{icon:'üéØ',title:'–ê—Ä—Ç-–¥–∏—Ä–µ–∫—Ç–æ—Ä',vacancies:3600,salary:'150‚Äì400',growth:'+18%',trend:'up',demand:72,skills:['–ë—Ä–µ–Ω–¥–∏–Ω–≥','–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ','–°—Ç—Ä–∞—Ç–µ–≥–∏—è'],color:'#00e5ff',years:['2020','2021','2022','2023','2024','2025'],chart:[1800,2100,2400,2800,3200,3600]}]
};

const flowCols=[{label:'–ö–û–õ–õ–ï–î–ñ',nodes:['–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä','–ì—Ä–∞—Ñ. –¥–∏–∑–∞–π–Ω–µ—Ä','–î–∏–∑–∞–π–Ω–µ—Ä','–î–∏–∑–∞–π–Ω–µ—Ä (–∫–æ—Å—Ç—é–º)']},{label:'–ï–ì–≠',nodes:['–†—É—Å—Å–∫–∏–π —è–∑—ã–∫','–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞','–ò—Å—Ç–æ—Ä–∏—è']},{label:'–ë–ê–ö–ê–õ–ê–í–†–ò–ê–¢',nodes:['–ê—Ä—Ö–∏—Ç–µ–∫—Ç. –ø—Ä–æ–µ–∫—Ç.','–ê—Ä—Ö–∏—Ç–µ–∫—Ç. –¥–∏–∑–∞–π–Ω','–ì—Ä–∞—Ñ. –¥–∏–∑–∞–π–Ω –∏ VR','–î–∏–∑–∞–π–Ω —Å—Ä–µ–¥—ã','–ü—Ä–æ–º–¥–∏–∑–∞–π–Ω','–î–∏–∑–∞–π–Ω –∫–æ—Å—Ç—é–º–∞','–¢–µ–∫—Å—Ç–∏–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω','–£–∫—Ä–∞—à–µ–Ω–∏—è','–ê—Ä—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç','–ò—Å–∫—É—Å—Å—Ç–≤–æ–≤–µ–¥.']},{label:'–ú–ê–ì–ò–°–¢–†–ê–¢–£–†–ê',nodes:['–¶–∏—Ñ—Ä–æ–≤–æ–π –¥–∏–∑–∞–π–Ω','–¶–∏—Ñ—Ä. –ø—Ä–æ–¥—É–∫—Ç','–ö—Ä–µ–∞—Ç–∏–≤. –∏–Ω–¥—É—Å—Ç—Ä–∏–∏']},{label:'–ê–°–ü–ò–†–ê–ù–¢–£–†–ê',nodes:['–î–ü–ò','–¢–µ—Ö–Ω. —ç—Å—Ç–µ—Ç–∏–∫–∞','–¢–µ–æ—Ä–∏—è –∫—É–ª—å—Ç—É—Ä—ã']}];
const flowEdges=[[0,1,1,0],[0,1,1,1],[1,0,2,2],[1,1,2,2],[2,2,3,0],[0,1,1,2],[1,0,2,3],[1,1,2,3],[1,2,2,3],[2,2,3,1],[2,3,3,1],[3,0,4,1],[0,0,1,0],[0,0,1,1],[0,0,1,2],[1,0,2,0],[1,1,2,0],[1,2,2,0],[1,0,2,1],[1,1,2,1],[0,2,1,0],[0,2,1,1],[1,0,2,4],[1,1,2,4],[0,3,1,0],[0,3,1,1],[1,0,2,5],[1,1,2,5],[2,8,3,2],[3,2,4,2],[2,0,4,0],[1,0,2,6],[1,1,2,6],[1,0,2,7],[1,1,2,7],[1,0,2,8],[1,1,2,8],[1,0,2,9],[1,1,2,9],[2,4,3,1],[3,1,4,1],[2,5,3,2],[3,2,4,1]];

const clusterFlowNodes={
  graphic:{my:{'0,1':1,'1,0':1,'1,1':1,'2,2':1,'3,0':1},alt:{'1,2':1,'2,3':1,'3,1':1,'4,1':1},badges:{'2,2':'—Ä–µ–∫.'}},
  arch:{my:{'0,0':1,'1,0':1,'1,1':1,'1,2':1,'2,0':1,'2,1':1},alt:{'2,3':1,'3,0':1,'4,0':1},badges:{'2,0':'—Ä–µ–∫.'}},
  env:{my:{'0,2':1,'1,0':1,'1,1':1,'2,3':1},alt:{'1,2':1,'2,2':1,'3,1':1,'4,1':1},badges:{'2,3':'—Ä–µ–∫.'}},
  fashion:{my:{'0,3':1,'1,0':1,'1,1':1,'2,5':1},alt:{'2,6':1,'2,7':1,'3,2':1,'4,2':1},badges:{'2,5':'—Ä–µ–∫.'}},
  product:{my:{'0,2':1,'1,0':1,'1,1':1,'2,4':1},alt:{'2,2':1,'2,3':1,'3,0':1,'3,1':1},badges:{'2,4':'—Ä–µ–∫.'}},
  mgmt:{my:{'1,0':1,'1,1':1,'2,8':1,'2,9':1,'3,2':1,'4,2':1},alt:{'2,2':1,'3,0':1,'3,1':1},badges:{'3,2':'—Ä–µ–∫.'}}
};
const eduColMap={'9class':1,'11class':1,'spo':0,'bachelor':2,'master':3};

function getNodePath(ci,ni,ck){const k=ci+','+ni;const cfg=clusterFlowNodes[ck];if(cfg.my[k])return'my';if(cfg.alt[k])return'alt';return'dim'}
function getNodeBadge(ci,ni,ck){const k=ci+','+ni;return clusterFlowNodes[ck].badges[k]||null}
function getEdgeType(fc,fi,tc,ti,ck){const f=getNodePath(fc,fi,ck),t=getNodePath(tc,ti,ck);if(f==='my'&&t==='my')return'my';if(f!=='dim'&&t!=='dim')return'alt';return'dim'}

function initResults(){
  const{primary,secondary}=findCluster();const dirs=computeDirections();const skills=computeSkills();const cl=clusters[primary];
  const level=XP.level;const xp=XP.total;
  // HERO
  const parts=cl.name.split('\n');
  document.getElementById('heroClass').innerHTML='<span class="highlight">'+parts[0]+'</span><br>'+parts[1];
  document.getElementById('heroDesc').textContent=cl.desc;document.getElementById('heroIcon').textContent=cl.icon;
  // TG avatar ‚Äî show photo OR icon, not both
  let hasAvatar=false;
  if(tg&&tg.initDataUnsafe&&tg.initDataUnsafe.user){const u=tg.initDataUnsafe.user;if(u.photo_url){document.getElementById('tgAvatar').src=u.photo_url;document.getElementById('tgName').textContent=(u.first_name||'')+(u.last_name?' '+u.last_name:'');document.getElementById('avatarWrap').style.display='flex';hasAvatar=true}}
  document.getElementById('heroIcon').style.display=hasAvatar?'none':'flex';
  // LEVEL
  document.getElementById('lvlBadge').innerHTML=level+'<span>–£—Ä–æ–≤–µ–Ω—å</span>';
  document.getElementById('lvlName').textContent=levelNames[level];document.getElementById('lvlSub').textContent=levelSubs[level];
  document.getElementById('xpText').textContent=xp+' / 1 000 XP';
  setTimeout(()=>{document.getElementById('xpFill').style.width=Math.min(100,xp/10)+'%'},500);
  // PIPS
  const wrap=document.getElementById('lvlPips');let html='';for(let i=1;i<=10;i++){const cls=i<level?'filled':i===level?'current':'';html+='<div class="lvl-pip '+cls+'"></div>'}wrap.innerHTML=html;
  // ACHIEVEMENTS
  if(S.achievements.length){document.getElementById('achRow').innerHTML=S.achievements.map(a=>'<div class="ach-item">üèÖ '+a+'</div>').join('')}
  // RADARS
  const radarSize=Math.min(360,window.innerWidth-60);
  drawRadar('radarDir',['–ê—Ä—Ö–∏—Ç–µ–∫—Ç.','–°—Ä–µ–¥–∞','–ì—Ä–∞—Ñ–∏–∫–∞','–ú–æ–¥–∞','–ü—Ä–æ–º–¥–∏–∑.','–ú–µ–Ω–µ–¥–∂–º.'],[dirs.arch,dirs.env,dirs.graphic,dirs.fashion,dirs.product,dirs.mgmt],'#00e5ff','#b388ff',radarSize);
  drawRadar('radarSkills',['–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ','–ú–∞—Ç–µ—Ä–∏–∞–ª','–í–∏–∑—É–∞–ª','–ö–æ–º–º—É–Ω–∏–∫.','–°—Ç—Ä–∞—Ç–µ–≥–∏—è'],[skills.space,skills.material,skills.visual,skills.comm,skills.strategy],'#b388ff','#ff6b9d',radarSize);
  // FLOW
  drawFlowCanvas(primary);
  // DEMAND
  renderDemand(primary,secondary);
  // SHARE
  document.getElementById('shareTitle').textContent=parts.join(' ')+' ¬∑ –£—Ä–æ–≤–µ–Ω—å '+level;
  // REVEAL
  setTimeout(()=>{const obs=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting)e.target.classList.add('visible')})},{threshold:0.08});document.querySelectorAll('#screen-results .reveal').forEach(el=>obs.observe(el))},200);
  // Hide XP HUD on results
  document.getElementById('xpHud').classList.remove('visible');
  document.getElementById('progressBar').style.width='100%';
}

function drawRadar(canvasId,labels,values,color1,color2,SIZE){
  SIZE=SIZE||360;const canvas=document.getElementById(canvasId);const dpr=window.devicePixelRatio||1;
  canvas.width=SIZE*dpr;canvas.height=SIZE*dpr;canvas.style.width=SIZE+'px';canvas.style.height=SIZE+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const cx=SIZE/2,cy=SIZE/2,R=SIZE*0.3,n=labels.length;let frame=0;const total=60;
  function ang(i){return(Math.PI*2*i/n)-Math.PI/2}
  function hexToRgb(hex){return parseInt(hex.slice(1,3),16)+','+parseInt(hex.slice(3,5),16)+','+parseInt(hex.slice(5,7),16)}
  const rgb1=hexToRgb(color1),rgb2=hexToRgb(color2);
  function draw(p){
    const ease=1-Math.pow(1-p,3);ctx.clearRect(0,0,SIZE,SIZE);
    for(let ring=1;ring<=5;ring++){const r=R*ring/5;ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.strokeStyle=ring===5?'rgba('+rgb1+',0.2)':'rgba(255,255,255,0.04)';ctx.lineWidth=ring===5?1.5:1;ctx.stroke()}
    for(let i=0;i<n;i++){const a=ang(i);ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+R*Math.cos(a),cy+R*Math.sin(a));ctx.strokeStyle='rgba(255,255,255,0.05)';ctx.lineWidth=1;ctx.stroke()}
    ctx.beginPath();for(let i=0;i<=n;i++){const idx=i%n,v=(values[idx]/100)*R*ease,a=ang(idx);const x=cx+v*Math.cos(a),y=cy+v*Math.sin(a);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)}ctx.closePath();
    const grad=ctx.createLinearGradient(cx-R,cy-R,cx+R,cy+R);grad.addColorStop(0,'rgba('+rgb1+',0.2)');grad.addColorStop(1,'rgba('+rgb2+',0.08)');ctx.fillStyle=grad;ctx.fill();
    const strokeGrad=ctx.createLinearGradient(cx-R,cy-R,cx+R,cy+R);strokeGrad.addColorStop(0,color1);strokeGrad.addColorStop(1,color2);ctx.strokeStyle=strokeGrad;ctx.lineWidth=2;ctx.stroke();
    for(let i=0;i<n;i++){const v=(values[i]/100)*R*ease,a=ang(i);const dx=cx+v*Math.cos(a),dy=cy+v*Math.sin(a);const t=i/(n-1);ctx.beginPath();ctx.arc(dx,dy,4,0,Math.PI*2);ctx.fillStyle=t<0.5?color1:color2;ctx.fill()}
    for(let i=0;i<n;i++){const a=ang(i),val=Math.round(values[i]*ease);const dist=R+30;const lx=cx+dist*Math.cos(a),ly=cy+dist*Math.sin(a);const cos=Math.cos(a);ctx.textAlign=cos>0.3?'left':cos<-0.3?'right':'center';ctx.textBaseline='bottom';ctx.font='800 14px PPNeueMachina,sans-serif';const t=i/(n-1);ctx.fillStyle=t<0.5?color1:color2;ctx.fillText(val,lx,ly);ctx.textBaseline='top';ctx.font='600 12px Gilroy,sans-serif';ctx.fillStyle='#868686';ctx.fillText(labels[i],lx,ly+2)}
  }
  function animate(){frame++;draw(Math.min(1,frame/total));if(frame<total)requestAnimationFrame(animate)}
  const obs=new IntersectionObserver(entries=>{if(entries[0].isIntersecting){animate();obs.disconnect()}},{threshold:0.3});obs.observe(canvas);
}

function drawFlowCanvas(clusterKey){
  const canvas=document.getElementById('flowCanvas');const dpr=window.devicePixelRatio||1;const W=1200,H=640;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const gap=12,colW=(W-40-gap*4)/5,startX=20;const colXs=[];for(let i=0;i<5;i++)colXs.push(startX+i*(colW+gap));
  const nodeH=44,gapY=6,topY=52;const rects=[];
  flowCols.forEach((col,ci)=>{rects[ci]=[];col.nodes.forEach((name,ni)=>{rects[ci][ni]={x:colXs[ci],y:topY+ni*(nodeH+gapY),w:colW,h:nodeH,name,path:getNodePath(ci,ni,clusterKey),badge:getNodeBadge(ci,ni,clusterKey)}})});
  ctx.fillStyle='#222222';ctx.fillRect(0,0,W,H);
  const hereCol=eduColMap[S.edu];
  ctx.textAlign='center';ctx.textBaseline='middle';flowCols.forEach((col,ci)=>{
    const cx=colXs[ci]+colW/2;
    if(ci===hereCol){
      ctx.font='800 11px PPNeueMachina,sans-serif';const badge='–¢–´ –ó–î–ï–°–¨';const bw=ctx.measureText(badge).width+14;
      const bx=cx-bw/2,by=6,bh=18,br=9;ctx.beginPath();ctx.moveTo(bx+br,by);ctx.lineTo(bx+bw-br,by);ctx.arcTo(bx+bw,by,bx+bw,by+br,br);ctx.lineTo(bx+bw,by+bh-br);ctx.arcTo(bx+bw,by+bh,bx+bw-br,by+bh,br);ctx.lineTo(bx+br,by+bh);ctx.arcTo(bx,by+bh,bx,by+bh-br,br);ctx.lineTo(bx,by+br);ctx.arcTo(bx,by,bx+br,by,br);ctx.closePath();ctx.fillStyle='#00e5ff';ctx.fill();
      ctx.fillStyle='#111';ctx.fillText(badge,cx,15);
      ctx.font='800 12px PPNeueMachina,sans-serif';ctx.fillStyle='#00e5ff';ctx.fillText(col.label,cx,36);
    }else{
      ctx.font='800 12px PPNeueMachina,sans-serif';ctx.fillStyle='#868686';ctx.fillText(col.label,cx,20);
    }
  });
  flowEdges.forEach(([fc,fi,tc,ti])=>{const from=rects[fc]?.[fi],to=rects[tc]?.[ti];if(!from||!to)return;const x1=from.x+from.w,y1=from.y+from.h/2,x2=to.x,y2=to.y+to.h/2,mx=(x1+x2)/2;const type=getEdgeType(fc,fi,tc,ti,clusterKey);ctx.beginPath();ctx.moveTo(x1,y1);ctx.bezierCurveTo(mx,y1,mx,y2,x2,y2);if(type==='my'){ctx.strokeStyle='rgba(0,229,255,0.5)';ctx.lineWidth=2.5;ctx.shadowColor='rgba(0,229,255,0.2)';ctx.shadowBlur=6}else if(type==='alt'){ctx.strokeStyle='rgba(251,191,36,0.35)';ctx.lineWidth=1.5;ctx.setLineDash([5,4]);ctx.shadowBlur=0}else{ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=1;ctx.shadowBlur=0}ctx.stroke();ctx.setLineDash([]);ctx.shadowBlur=0});
  flowCols.forEach((col,ci)=>{col.nodes.forEach((name,ni)=>{const r=rects[ci][ni];ctx.beginPath();ctx.rect(r.x,r.y,r.w,r.h);if(r.path==='my'){ctx.fillStyle='rgba(0,229,255,0.06)';ctx.strokeStyle='rgba(0,229,255,0.6)';ctx.lineWidth=1.5}else if(r.path==='alt'){ctx.fillStyle='rgba(251,191,36,0.04)';ctx.strokeStyle='rgba(251,191,36,0.3)';ctx.lineWidth=1}else{ctx.fillStyle='rgba(255,255,255,0.02)';ctx.strokeStyle='rgba(255,255,255,0.06)';ctx.lineWidth=1}ctx.fill();ctx.stroke();ctx.textAlign='center';ctx.textBaseline='middle';ctx.font='600 11px Gilroy,sans-serif';ctx.fillStyle=r.path==='dim'?'rgba(255,255,255,0.2)':r.path==='my'?'#ffffff':'rgba(255,255,255,0.7)';ctx.fillText(name,r.x+r.w/2,r.y+r.h/2);if(r.badge){ctx.font='800 11px PPNeueMachina,sans-serif';const txt=r.badge.toUpperCase();const bw=ctx.measureText(txt).width+16;const bx=r.x+r.w-bw-4,by=r.y-11;ctx.beginPath();ctx.rect(bx,by,bw,20);ctx.fillStyle=r.path==='my'?'#00e5ff':'#fbbf24';ctx.fill();ctx.fillStyle='#222222';ctx.textAlign='center';ctx.fillText(txt,bx+bw/2,by+10)}})});
}

function renderDemand(primaryKey,secondaryKey){
  const grid=document.getElementById('demandGrid');const primaryData=demandData[primaryKey]||demandData.graphic;const secondaryData=demandData[secondaryKey]||demandData.env;
  grid.innerHTML='<div class="demand-col"><div class="demand-col-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π ¬∑ '+clusterLabels[primaryKey]+'</div>'+primaryData.map(d=>dCard(d)).join('')+'</div><div class="demand-col"><div class="demand-col-label">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π ¬∑ '+clusterLabels[secondaryKey]+'</div>'+secondaryData.map(d=>dCard(d)).join('')+'</div>';
  setTimeout(()=>{document.querySelectorAll('.d-chart canvas').forEach(c=>{drawBarChart(c,JSON.parse(c.dataset.chart),JSON.parse(c.dataset.years),c.dataset.color)})},300);
}
function dCard(d){
  const hot=d.demand>=80?'hot':d.demand>=55?'warm':'';
  return '<div class="d-card"><div class="d-head"><div class="d-icon">'+d.icon+'</div><div class="d-title">'+d.title+'</div></div><div class="d-metrics"><div class="d-m"><div class="d-m-val '+hot+'">'+(d.vacancies/1000).toFixed(1)+'K</div><div class="d-m-label">–í–∞–∫–∞–Ω—Å–∏–π</div></div><div class="d-m"><div class="d-m-val">'+d.salary+'</div><div class="d-m-label">—Ç—ã—Å. ‚ÇΩ/–º–µ—Å</div></div><div class="d-m"><div class="d-m-val '+hot+'">'+d.demand+'%</div><div class="d-m-label">–°–ø—Ä–æ—Å</div></div></div><div class="d-chart"><canvas data-chart=\''+JSON.stringify(d.chart)+'\' data-years=\''+JSON.stringify(d.years)+'\' data-color="'+d.color+'"></canvas></div><div class="d-chips">'+d.skills.map(s=>'<span class="d-chip">'+s+'</span>').join('')+'</div><div class="d-trend '+d.trend+'">'+(d.trend==='up'?'‚Üë':'‚Üí')+' '+d.growth+' –∑–∞ –≥–æ–¥</div></div>';
}
function drawBarChart(canvas,data,years,color){
  const dpr=window.devicePixelRatio||1;const rect=canvas.parentElement.getBoundingClientRect();const W=rect.width-32,H=rect.height-32;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const n=data.length,barW=W/n*0.55;const gap2=(W-barW*n)/(n+1);const topPad=24,bottomPad=20;const max=Math.max(...data);const chartH=H-topPad-bottomPad;const baseY=topPad+chartH;
  const r=parseInt(color.slice(1,3),16),g=parseInt(color.slice(3,5),16),b=parseInt(color.slice(5,7),16);
  data.forEach((v,i)=>{const x=gap2+i*(barW+gap2);const h=(v/max)*chartH,y=baseY-h;const grad=ctx.createLinearGradient(x,y,x,baseY);if(i===n-1){grad.addColorStop(0,'rgba('+r+','+g+','+b+',0.7)');grad.addColorStop(1,'rgba('+r+','+g+','+b+',0.2)')}else{grad.addColorStop(0,'rgba('+r+','+g+','+b+',0.25)');grad.addColorStop(1,'rgba('+r+','+g+','+b+',0.05)')}ctx.fillStyle=grad;ctx.fillRect(x,y,barW,baseY-y);if(i===n-1){ctx.font='800 13px PPNeueMachina,sans-serif';ctx.fillStyle=color;ctx.textAlign='center';ctx.textBaseline='bottom';ctx.fillText((v/1000).toFixed(1)+'K',x+barW/2,y-4)}ctx.font='600 12px Gilroy,sans-serif';ctx.fillStyle=i===n-1?'rgba('+r+','+g+','+b+',0.8)':'rgba(255,255,255,0.2)';ctx.textAlign='center';ctx.textBaseline='top';ctx.fillText(years[i],x+barW/2,baseY+4)});
}

function shareResult(){if(tg){tg.close()}else{alert('–í Telegram ‚Äî –ø–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –±–æ—Ç–∞!')}}
</script>
</body>
</html>
